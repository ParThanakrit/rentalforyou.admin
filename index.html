<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rental For You - Admin v5</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root{--cream:#FAF7F2;--cream-dark:#F0EBE3;--brown:#5D4E37;--brown-light:#8B7355;--gold:#C9A962;--white:#FFFFFF;--green:#4CAF50;--red:#f44336;--blue:#2196F3;--orange:#FF9800;--shadow:rgba(93,78,55,0.1)}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Prompt',sans-serif;background:var(--cream);min-height:100vh;color:var(--brown)}
        .login-page{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--cream) 0%,var(--cream-dark) 100%)}
        .login-card{background:var(--white);padding:40px;border-radius:20px;box-shadow:0 10px 40px var(--shadow);max-width:400px;width:90%;text-align:center}
        .login-logo{font-size:2rem;font-weight:700;color:var(--brown);margin-bottom:10px}
        .login-logo span{color:var(--gold)}
        .login-subtitle{color:var(--brown-light);margin-bottom:30px}
        .login-input{width:100%;padding:15px;border:2px solid var(--cream-dark);border-radius:10px;font-size:1rem;font-family:'Prompt',sans-serif;text-align:center;letter-spacing:3px;margin-bottom:20px}
        .login-input:focus{outline:none;border-color:var(--gold)}
        .login-btn{width:100%;padding:15px;background:var(--brown);color:var(--white);border:none;border-radius:10px;font-size:1rem;font-weight:600;cursor:pointer;font-family:'Prompt',sans-serif}
        .login-btn:hover{background:var(--gold)}
        .login-error{color:var(--red);margin-top:15px;display:none}
        .admin-panel{display:none}
        .header{background:var(--brown);color:var(--white);padding:15px 20px;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:100}
        .header h1{font-size:1.2rem}
        .header-btns{display:flex;gap:10px}
        .header-btn{background:rgba(255,255,255,0.2);color:var(--white);border:none;padding:8px 15px;border-radius:20px;cursor:pointer;font-family:'Prompt',sans-serif;font-size:0.85rem}
        .header-btn:hover{background:rgba(255,255,255,0.3)}
        .header-btn.logout{background:var(--red)}
        .tabs{display:flex;background:var(--white);border-bottom:2px solid var(--cream-dark);overflow-x:auto}
        .tab{padding:15px 25px;border:none;background:none;cursor:pointer;font-family:'Prompt',sans-serif;font-size:0.95rem;color:var(--brown-light);border-bottom:3px solid transparent;white-space:nowrap}
        .tab:hover{color:var(--brown)}
        .tab.active{color:var(--brown);border-bottom-color:var(--gold);font-weight:600}
        .container{max-width:1200px;margin:0 auto;padding:20px}
        .page{display:none}.page.active{display:block}
        .card{background:var(--white);border-radius:16px;padding:25px;margin-bottom:20px;box-shadow:0 4px 20px var(--shadow)}
        .card-title{font-size:1.1rem;font-weight:600;margin-bottom:20px;color:var(--brown)}
        .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-bottom:20px}
        .stat-card{background:var(--white);border-radius:12px;padding:20px;box-shadow:0 4px 15px var(--shadow);text-align:center}
        .stat-card.warning{border-left:4px solid var(--orange)}
        .stat-card.danger{border-left:4px solid var(--red)}
        .stat-card.success{border-left:4px solid var(--green)}
        .stat-card.info{border-left:4px solid var(--blue)}
        .stat-number{font-size:2rem;font-weight:700;color:var(--brown)}
        .stat-label{font-size:0.85rem;color:var(--brown-light)}
        .alert{padding:15px 20px;border-radius:10px;margin-bottom:15px}
        .alert.warning{background:#FFF3E0;border:1px solid var(--orange);color:#E65100}
        .alert.danger{background:#FFEBEE;border:1px solid var(--red);color:#C62828}
        .alert.success{background:#E8F5E9;border:1px solid var(--green);color:#2E7D32}
        .table-wrapper{overflow-x:auto}
        table{width:100%;border-collapse:collapse;font-size:0.9rem}
        th,td{padding:12px 15px;text-align:left;border-bottom:1px solid var(--cream-dark)}
        th{background:var(--cream);font-weight:600}
        tr:hover{background:var(--cream)}
        .status-badge{padding:5px 12px;border-radius:15px;font-size:0.8rem;font-weight:500}
        .status-pending{background:#FFF3E0;color:#E65100}
        .status-confirmed{background:#E3F2FD;color:#1565C0}
        .status-shipped{background:#F3E5F5;color:#7B1FA2}
        .status-returned{background:#E8F5E9;color:#2E7D32}
        .status-cancelled{background:#FFEBEE;color:#C62828}
        .action-btn{padding:5px 10px;border:none;border-radius:5px;cursor:pointer;font-size:0.8rem}
        .action-btn.edit{background:var(--orange);color:white}
        .form-group{margin-bottom:20px}
        .form-label{display:block;font-size:0.9rem;font-weight:500;margin-bottom:8px;color:var(--brown)}
        .form-input,.form-select,.form-textarea{width:100%;padding:12px 15px;border:2px solid var(--cream-dark);border-radius:10px;font-family:'Prompt',sans-serif;font-size:1rem;color:var(--brown)}
        .form-input:focus,.form-select:focus,.form-textarea:focus{outline:none;border-color:var(--gold)}
        .form-textarea{min-height:80px;resize:vertical}
        .form-row{display:grid;grid-template-columns:1fr 1fr;gap:15px}
        .dress-selector{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:15px}
        .dress-chip{padding:10px 15px;background:var(--cream);border:2px solid var(--cream-dark);border-radius:25px;cursor:pointer;font-size:0.9rem}
        .dress-chip:hover{border-color:var(--gold)}
        .dress-chip.selected{background:var(--gold);border-color:var(--gold);color:var(--white)}
        .dress-chip .price{font-size:0.8rem;opacity:0.8;margin-left:5px}
        .selected-item{display:flex;justify-content:space-between;align-items:center;padding:12px 15px;background:var(--cream);border-radius:10px;margin-bottom:10px}
        .selected-item .info{flex:1}
        .selected-item .name{font-weight:600}
        .selected-item .detail{font-size:0.85rem;color:var(--brown-light)}
        .selected-item .remove{background:var(--red);color:var(--white);border:none;width:30px;height:30px;border-radius:50%;cursor:pointer;font-size:1rem}
        .days-selector{display:flex;gap:10px}
        .day-btn{flex:1;padding:15px;border:2px solid var(--cream-dark);background:var(--white);border-radius:10px;cursor:pointer;text-align:center}
        .day-btn:hover{border-color:var(--gold)}
        .day-btn.active{border-color:var(--gold);background:var(--gold);color:var(--white)}
        .checkbox-group{display:flex;align-items:center;gap:10px;padding:15px;background:var(--cream);border-radius:10px;margin-bottom:15px}
        .checkbox-group input{width:20px;height:20px;cursor:pointer;accent-color:var(--gold)}
        .price-summary{background:linear-gradient(135deg,var(--cream) 0%,var(--cream-dark) 100%);border-radius:16px;padding:25px}
        .price-row{display:flex;justify-content:space-between;padding:10px 0;font-size:0.95rem}
        .price-row.discount{color:var(--green)}
        .price-row.subtotal{border-top:1px dashed var(--brown-light);margin-top:10px;padding-top:15px;font-weight:600}
        .price-row.deposit{color:var(--brown-light)}
        .price-row.total{background:var(--brown);color:var(--white);margin:15px -25px -25px;padding:20px 25px;border-radius:0 0 16px 16px;font-size:1.2rem;font-weight:600}
        .btn{padding:15px 25px;border:none;border-radius:12px;font-family:'Prompt',sans-serif;font-size:1rem;font-weight:600;cursor:pointer;display:inline-flex;align-items:center;gap:8px}
        .btn-primary{background:linear-gradient(135deg,var(--brown) 0%,var(--brown-light) 100%);color:var(--white)}
        .btn-success{background:var(--green);color:var(--white)}
        .btn-warning{background:var(--orange);color:var(--white)}
        .btn-outline{background:var(--white);color:var(--brown);border:2px solid var(--brown)}
        .btn:hover{transform:translateY(-2px);box-shadow:0 5px 20px var(--shadow)}
        .btn-block{width:100%;justify-content:center;margin-top:10px}
        .note{background:#FFF3E0;border:1px solid #FFB74D;border-radius:10px;padding:15px;margin-top:15px;font-size:0.9rem;color:#E65100}
        .deposit-note{background:#E3F2FD;border:1px solid #64B5F6;border-radius:10px;padding:15px;margin-top:15px;font-size:0.9rem;color:#1565C0}
        .config-block{background:#FFF8E1;border:2px dashed var(--gold);border-radius:12px;padding:20px;margin-bottom:20px}
        .config-block h3{color:var(--brown);margin-bottom:15px;font-size:1rem}
        .print-area{display:none}
        @media print{body *{visibility:hidden}.print-area,.print-area *{visibility:visible}.print-area{display:block;position:absolute;left:0;top:0;width:100%}@page{size:A4 landscape;margin:5mm}}
        .print-page-landscape{width:297mm;height:210mm;padding:8mm;background:white;font-family:'Prompt',sans-serif;display:flex;gap:5mm}
        .label-half{flex:1;border:2px solid #333;padding:8mm;position:relative;display:flex;flex-direction:column}
        .label-half.return{border-style:dashed;border-color:#666}
        .label-header{text-align:center;padding-bottom:5mm;border-bottom:2px solid #333;margin-bottom:5mm}
        .label-header.return{border-color:#f44336}
        .label-type-badge{display:inline-block;padding:5px 20px;border-radius:20px;font-weight:700;font-size:14pt}
        .label-type-badge.send{background:#E3F2FD;color:#1565C0}
        .label-type-badge.return{background:#FFEBEE;color:#C62828}
        .label-body{flex:1;display:flex;flex-direction:column;gap:5mm}
        .address-section{display:flex;gap:5mm}
        .address-box{flex:1;border:1px solid #ddd;border-radius:8px;padding:10px}
        .address-box.highlight-blue{background:#E3F2FD;border-color:#2196F3}
        .address-box.highlight-red{background:#FFEBEE;border-color:#f44336}
        .address-box-title{font-size:9pt;color:#666;margin-bottom:5px}
        .address-box h3{font-size:14pt;margin:0 0 5px 0;color:#333}
        .address-box .phone{font-size:12pt;color:#666;margin-bottom:5px}
        .address-box .addr{font-size:10pt;line-height:1.4;color:#333;white-space:pre-line}
        .info-section{display:flex;gap:5mm}
        .info-box{flex:1;background:#f5f5f5;border-radius:8px;padding:10px}
        .info-row{display:flex;justify-content:space-between;padding:5px 0;font-size:11pt;border-bottom:1px dashed #ddd}
        .info-row:last-child{border-bottom:none}
        .info-row strong{color:#666}
        .info-row span{color:#333;font-weight:600}
        .info-row.highlight{background:#FFEBEE;margin:5px -10px;padding:8px 10px;border-radius:5px}
        .info-row.highlight span{color:#f44336;font-weight:700}
        .brand-box{text-align:center;padding:10px}
        .brand-logo{font-size:16pt;font-weight:700;color:#5D4E37}
        .brand-logo span{color:#C9A962}
        .brand-contact{font-size:9pt;color:#888;margin-top:5px}
        .cut-indicator{position:absolute;top:50%;right:-15mm;transform:translateY(-50%) rotate(90deg);font-size:9pt;color:#999;white-space:nowrap}
        .copy-success{position:fixed;top:20px;right:20px;background:var(--green);color:var(--white);padding:15px 25px;border-radius:10px;z-index:1000;display:none}
        @media(max-width:768px){.form-row{grid-template-columns:1fr}.stats-grid{grid-template-columns:1fr 1fr}.days-selector{flex-wrap:wrap}.day-btn{min-width:calc(33% - 10px)}}
    </style>
</head>
<body>
    <div class="login-page" id="loginPage">
        <div class="login-card">
            <div class="login-logo">Rental <span>For You</span></div>
            <div class="login-subtitle">Admin Panel v5 - with Calendar Management</div>
            <input type="password" class="login-input" id="passwordInput" placeholder="password" maxlength="20">
            <button class="login-btn" onclick="login()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
            <div class="login-error" id="loginError">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</div>
        </div>
    </div>

    <div class="admin-panel" id="adminPanel">
        <header class="header">
            <h1>Rental For You - Admin v5</h1>
            <div class="header-btns">
                <button class="header-btn" onclick="refreshData()">‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
                <button class="header-btn logout" onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>
        </header>

        <div class="tabs">
            <button class="tab active" onclick="showTab('dashboard',this)">Dashboard</button>
            <button class="tab" onclick="showTab('newOrder',this)">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button>
            <button class="tab" onclick="showTab('orders',this)">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button>
            <button class="tab" onclick="showTab('calendar',this)">üìÖ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô</button>
            <button class="tab" onclick="showTab('shipping',this)">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡πà‡∏á‡∏ä‡∏∏‡∏î</button>
            <button class="tab" onclick="showTab('settings',this)">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
        </div>

        <div class="container">
            <div class="page active" id="dashboardPage">
                <div class="stats-grid">
                    <div class="stat-card warning"><div class="stat-number" id="statPending">0</div><div class="stat-label">‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</div></div>
                    <div class="stat-card info"><div class="stat-number" id="statConfirmed">0</div><div class="stat-label">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß</div></div>
                    <div class="stat-card success"><div class="stat-number" id="statShipped">0</div><div class="stat-label">‡∏™‡πà‡∏á‡∏ä‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß</div></div>
                    <div class="stat-card danger"><div class="stat-number" id="statReturn">0</div><div class="stat-label">‡∏£‡∏≠‡∏™‡πà‡∏á‡∏Ñ‡∏∑‡∏ô</div></div>
                </div>
                <div class="card"><div class="card-title">‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏á‡∏ä‡∏∏‡∏î‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div><div id="todayShipments"><div class="alert success">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div></div></div>
                <div class="card"><div class="card-title">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏Ñ‡∏∑‡∏ô</div><div id="returnAlerts"><div class="alert success">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ñ‡∏∑‡∏ô</div></div></div>
                <div class="card"><div class="card-title">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</div><div class="table-wrapper"><table><thead><tr><th>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</th><th>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th><th>‡∏ä‡∏∏‡∏î</th><th>‡∏ß‡∏±‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</th><th>‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th></tr></thead><tbody id="recentOrders"><tr><td colspan="6" style="text-align:center">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr></tbody></table></div></div>
            </div>

            <div class="page" id="newOrderPage">
                <div class="card"><div class="card-title">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏ä‡πà‡∏≤</div><div class="dress-selector" id="dressSelector"></div><div id="selectedList"></div></div>
                <div class="card"><div class="card-title">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡πÄ‡∏ä‡πà‡∏≤</div><div class="days-selector"><button class="day-btn" onclick="selectDays(1)">1 ‡∏ß‡∏±‡∏ô</button><button class="day-btn active" onclick="selectDays(3)">3 ‡∏ß‡∏±‡∏ô</button><button class="day-btn" onclick="selectDays(5)">5 ‡∏ß‡∏±‡∏ô</button></div></div>
                <div class="card"><div class="card-title">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</div><div class="checkbox-group"><input type="checkbox" id="oldCustomer" onchange="calculate()"><label for="oldCustomer">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Å‡πà‡∏≤ (‡∏•‡∏î 5%)</label></div><div class="note">‡πÄ‡∏ä‡πà‡∏≤ 3 ‡∏ä‡∏∏‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ ‡∏•‡∏î 10% | ‡πÄ‡∏ä‡πà‡∏≤ 2 ‡∏ä‡∏∏‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ ‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ</div></div>
                <div class="card"><div class="card-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</div><div class="form-group"><label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</label><input type="text" class="form-input" id="customerName" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•"></div><div class="form-row"><div class="form-group"><label class="form-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label><input type="tel" class="form-input" id="customerPhone" placeholder="0xx-xxx-xxxx"></div><div class="form-group"><label class="form-label">Line ID</label><input type="text" class="form-input" id="customerLine" placeholder="Line ID"></div></div><div class="form-group"><label class="form-label">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</label><textarea class="form-textarea" id="customerAddress" placeholder="‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ‡∏ã‡∏≠‡∏¢ ‡∏ñ‡∏ô‡∏ô..."></textarea></div></div>
                <div class="card"><div class="card-title">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ß‡∏±‡∏ô‡πÄ‡∏ä‡πà‡∏≤</div><div class="form-row"><div class="form-group"><label class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏ä‡∏∏‡∏î</label><input type="date" class="form-input" id="startDate" onchange="calculateDates()"></div><div class="form-group"><label class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏ä‡∏∏‡∏î</label><input type="date" class="form-input" id="pickupDate" readonly></div></div><div class="form-row"><div class="form-group"><label class="form-label">‡∏ß‡∏±‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ</label><input type="date" class="form-input" id="endDate" readonly></div><div class="form-group"><label class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏™‡πà‡∏á‡∏Ñ‡∏∑‡∏ô</label><input type="date" class="form-input" id="returnDate" readonly></div></div><div class="note">‡∏™‡πà‡∏á‡∏ä‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô 4 ‡∏ß‡∏±‡∏ô | ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏™‡πà‡∏á‡∏Ñ‡∏∑‡∏ô‡∏ß‡∏±‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡∏´‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡πÄ‡∏™‡∏£‡πá‡∏à</div></div>
                <div class="card"><div class="card-title">‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</div><div class="price-summary" id="priceSummary"><div class="price-row"><span>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î</span><span>-</span></div></div><div class="deposit-note">‡∏Ñ‡πà‡∏≤‡∏°‡∏±‡∏î‡∏à‡∏≥ = ‡∏£‡∏≤‡∏Ñ‡∏≤ 3 ‡∏ß‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡∏ä‡∏∏‡∏î‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô</div></div>
                <div class="card"><div class="card-title">‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</div><button class="btn btn-primary btn-block" onclick="saveOrder()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå (Google Sheet)</button><button class="btn btn-success btn-block" onclick="generateSummary()">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏™‡πà‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</button><button class="btn btn-outline btn-block" onclick="copySummary()">Copy ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button><div id="orderSummaryBox" style="display:none;margin-top:20px;background:#1a1a2e;color:#0f0;padding:20px;border-radius:12px;font-family:monospace;font-size:0.85rem;white-space:pre-wrap;max-height:400px;overflow-y:auto"></div></div>
                <div class="card"><div class="card-title">‡∏õ‡∏£‡∏¥‡πâ‡∏ô‡πÉ‡∏ö‡∏õ‡∏∞‡∏´‡∏ô‡πâ‡∏≤ (A4 ‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô)</div><button class="btn btn-warning btn-block" onclick="printLabelLandscape()">‡∏õ‡∏£‡∏¥‡πâ‡∏ô‡πÉ‡∏ö‡∏õ‡∏∞‡∏´‡∏ô‡πâ‡∏≤ (‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô ‡∏ã‡πâ‡∏≤‡∏¢-‡∏Ç‡∏ß‡∏≤)</button><div class="note" style="margin-top:15px">‡∏õ‡∏£‡∏¥‡πâ‡∏ô 1 ‡πÅ‡∏ú‡πà‡∏ô A4 ‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô<br>‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏ã‡πâ‡∏≤‡∏¢ = ‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ | ‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏Ç‡∏ß‡∏≤ = ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö</div></div>
            </div>

            <div class="page" id="ordersPage">
                <div class="card"><div class="card-title">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div><div class="form-row" style="margin-bottom:20px"><div class="form-group" style="margin-bottom:0"><select class="form-select" id="filterStatus" onchange="filterOrders()"><option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option><option value="‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞">‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞</option><option value="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß</option><option value="‡∏™‡πà‡∏á‡∏ä‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß">‡∏™‡πà‡∏á‡∏ä‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß</option><option value="‡∏Ñ‡∏∑‡∏ô‡∏ä‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß">‡∏Ñ‡∏∑‡∏ô‡∏ä‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß</option><option value="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</option></select></div><div class="form-group" style="margin-bottom:0"><input type="text" class="form-input" id="searchOrder" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." oninput="filterOrders()"></div></div><div class="table-wrapper"><table><thead><tr><th>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</th><th>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th><th>‡∏ä‡∏∏‡∏î</th><th>‡∏ß‡∏±‡∏ô‡∏™‡πà‡∏á</th><th>‡∏ß‡∏±‡∏ô‡πÉ‡∏ä‡πâ</th><th>‡∏ß‡∏±‡∏ô‡∏Ñ‡∏∑‡∏ô</th><th>‡∏¢‡∏≠‡∏î</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead><tbody id="allOrders"><tr><td colspan="9" style="text-align:center">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr></tbody></table></div></div>
            </div>

            <div class="page" id="calendarPage">
                <div class="card">
                    <div class="card-title">üìÖ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏ä‡∏∏‡∏î‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á</div>
                    
                    <div class="alert warning" style="margin-bottom:20px">
                        <strong>üí° ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤‡∏ä‡∏∏‡∏î‡πÑ‡∏´‡∏ô‡∏ß‡πà‡∏≤‡∏á/‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á<br>
                        ‚Ä¢ <strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó "‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå"</strong> = ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á (‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ô‡∏ã‡∏±‡∏Å 3 ‡∏ß‡∏±‡∏ô)<br>
                        ‚Ä¢ <strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏∑‡πà‡∏ô‡πÜ</strong> = ‡∏ö‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏≠‡∏á (‡πÄ‡∏ä‡πà‡∏ô ‡∏ã‡πà‡∏≠‡∏°‡∏ä‡∏∏‡∏î, ‡∏ã‡∏±‡∏Å‡πÅ‡∏´‡πâ‡∏á, ‡∏à‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß)
                    </div>
                    
                    <div style="background:var(--cream);padding:20px;border-radius:12px;margin-bottom:20px">
                        <h3 style="margin-bottom:15px;color:var(--brown)">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ö‡∏•‡πá‡∏≠‡∏Å‡πÉ‡∏´‡∏°‡πà</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏ä‡∏∏‡∏î</label>
                                <select class="form-select" id="blockDressCode">
                                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
                                <select class="form-select" id="blockType">
                                    <option value="‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á</option>
                                    <option value="‡∏ã‡πà‡∏≠‡∏°‡∏ä‡∏∏‡∏î">‡∏ã‡πà‡∏≠‡∏°‡∏ä‡∏∏‡∏î</option>
                                    <option value="‡∏ã‡∏±‡∏Å‡πÅ‡∏´‡πâ‡∏á">‡∏ã‡∏±‡∏Å‡πÅ‡∏´‡πâ‡∏á</option>
                                    <option value="‡∏à‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß">‡∏à‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</option>
                                    <option value="‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤">‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ö‡∏•‡πá‡∏≠‡∏Å</label>
                                <input type="date" class="form-input" id="blockStartDate">
                            </div>
                            <div class="form-group">
                                <label class="form-label">‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ö‡∏•‡πá‡∏≠‡∏Å</label>
                                <input type="date" class="form-input" id="blockEndDate">
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="addNewBlock()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ö‡∏•‡πá‡∏≠‡∏Å</button>
                    </div>
                    
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Block ID</th>
                                    <th>‡∏£‡∏´‡∏±‡∏™‡∏ä‡∏∏‡∏î</th>
                                    <th>‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ö‡∏•‡πá‡∏≠‡∏Å</th>
                                    <th>‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ö‡∏•‡πá‡∏≠‡∏Å</th>
                                    <th>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤</th>
                                    <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                                    <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                </tr>
                            </thead>
                            <tbody id="calendarBlocksList">
                                <tr><td colspan="7" style="text-align:center;padding:40px">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="page" id="shippingPage">
                <div class="card"><div class="card-title">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡πà‡∏á‡∏ä‡∏∏‡∏î (7 ‡∏ß‡∏±‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤)</div><div id="shippingSchedule"></div></div>
                <div class="card"><div class="card-title">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô (7 ‡∏ß‡∏±‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤)</div><div id="returnSchedule"></div></div>
            </div>

            <div class="page" id="settingsPage">
                <div class="card config-block"><h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô</h3><div class="form-group"><label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô/‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö</label><input type="text" class="form-input" id="shopName" value="Rental For You"></div><div class="form-group"><label class="form-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏£‡πâ‡∏≤‡∏ô</label><input type="text" class="form-input" id="shopPhone" value="xxx-xxx-xxxx"></div><div class="form-group"><label class="form-label">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏£‡πâ‡∏≤‡∏ô</label><textarea class="form-textarea" id="shopAddress">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏£‡πâ‡∏≤‡∏ô</textarea></div><button class="btn btn-primary" onclick="saveShopInfo()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô</button></div>
                <div class="card config-block"><h3>‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</h3><div class="form-group"><label class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</label><input type="password" class="form-input" id="newPassword" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà"></div><div class="form-group"><label class="form-label">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label><input type="password" class="form-input" id="confirmPassword" placeholder="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô"></div><button class="btn btn-warning" onclick="changePassword()">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</button></div>
            </div>
        </div>
    </div>

    <div class="print-area" id="printArea"></div>
    <div id="copyNotification" class="copy-success">Copy ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</div>

    <script>
        const DEFAULT_PASSWORD = 'rental1234';
        
        // ‚ö†Ô∏è ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç! ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô API_URL ‡πÄ‡∏õ‡πá‡∏ô URL ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà Deploy ‡∏à‡∏≤‡∏Å apps_script_v3.js
        const API_URL = 'https://script.google.com/macros/s/AKfycbwjWNsnL28K3jCOi5E1d5BeV09351UvAUDH5-9yyam0kAl0ijBOf5bft5rF9fx8CHRy/exec';
        // ‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô URL ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö Web App URL ‡∏ó‡∏µ‡πà Deploy ‡πÉ‡∏´‡∏°‡πà!
        const dressData = [
            { code: 'B001', name: 'SO.MUTE', price1: 130, price3: 180, price5: 230 },
            { code: 'B002', name: 'MIFFY DRESS', price1: 80, price3: 110, price5: 140 },
            { code: 'B003', name: 'JOOBS STUDIO', price1: 170, price3: 230, price5: 300 },
            { code: 'B004', name: 'FALLIN ROSE', price1: 150, price3: 200, price5: 270 },
            { code: 'B005', name: 'LOOKBOOK', price1: 190, price3: 250, price5: 330 },
            { code: 'B006', name: 'NARYSTUDIO', price1: 110, price3: 150, price5: 200 },
            { code: 'B007', name: 'FALLIN ROSE', price1: 130, price3: 180, price5: 230 },
            { code: 'B008', name: 'FALLIN ROSE', price1: 110, price3: 150, price5: 200 },
            { code: 'B009', name: 'FALLIN ROSE', price1: 130, price3: 180, price5: 230 },
            { code: 'B010', name: 'FALLIN ROSE', price1: 120, price3: 160, price5: 210 },
            { code: 'B011', name: 'IMILY.STYLE', price1: 160, price3: 220, price5: 290 }
        ];
        let selectedDresses = [], selectedDays = 3, allOrdersData = [], allBlocks = [];

        function login() {
            const password = document.getElementById('passwordInput').value;
            const savedPassword = localStorage.getItem('adminPassword') || DEFAULT_PASSWORD;
            if (password === savedPassword) {
                localStorage.setItem('isLoggedIn', 'true');
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                initAdmin();
            } else {
                document.getElementById('loginError').style.display = 'block';
                setTimeout(() => document.getElementById('loginError').style.display = 'none', 3000);
            }
        }
        function logout() { localStorage.removeItem('isLoggedIn'); location.reload(); }
        function checkLogin() { if (localStorage.getItem('isLoggedIn') === 'true') { document.getElementById('loginPage').style.display = 'none'; document.getElementById('adminPanel').style.display = 'block'; initAdmin(); } }
        document.getElementById('passwordInput').addEventListener('keypress', e => { if (e.key === 'Enter') login(); });

        function initAdmin() { initDressSelector(); initCalendarPage(); loadShopInfo(); loadOrders(); loadCalendarBlocks(); }
        function initDressSelector() { document.getElementById('dressSelector').innerHTML = dressData.map(d => '<div class="dress-chip" onclick="toggleDress(\'' + d.code + '\')" id="chip-' + d.code + '">' + d.code + '<span class="price">' + d.price3 + '‡∏ø</span></div>').join(''); }
        function showTab(tabId, btn) { document.querySelectorAll('.tab').forEach(t => t.classList.remove('active')); btn.classList.add('active'); document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); document.getElementById(tabId + 'Page').classList.add('active'); }
        function toggleDress(code) { const index = selectedDresses.indexOf(code); if (index > -1) selectedDresses.splice(index, 1); else selectedDresses.push(code); updateUI(); }
        function removeDress(code) { const index = selectedDresses.indexOf(code); if (index > -1) selectedDresses.splice(index, 1); updateUI(); }
        function selectDays(days) { selectedDays = days; document.querySelectorAll('.day-btn').forEach(btn => btn.classList.remove('active')); event.target.closest('.day-btn').classList.add('active'); updateUI(); }

        function updateUI() {
            dressData.forEach(d => { const chip = document.getElementById('chip-' + d.code); chip.classList.toggle('selected', selectedDresses.includes(d.code)); });
            const listContainer = document.getElementById('selectedList');
            if (selectedDresses.length === 0) { listContainer.innerHTML = ''; }
            else { listContainer.innerHTML = selectedDresses.map(code => { const dress = dressData.find(d => d.code === code); const price = selectedDays === 1 ? dress.price1 : selectedDays === 3 ? dress.price3 : dress.price5; return '<div class="selected-item"><div class="info"><div class="name">' + dress.code + ' - ' + dress.name + '</div><div class="detail">' + selectedDays + ' ‡∏ß‡∏±‡∏ô = ' + price + ' ‡∏ö‡∏≤‡∏ó | ‡∏°‡∏±‡∏î‡∏à‡∏≥ ' + dress.price3 + ' ‡∏ö‡∏≤‡∏ó</div></div><button class="remove" onclick="removeDress(\'' + code + '\')">&times;</button></div>'; }).join(''); }
            calculate(); calculateDates();
        }

        function calculate() {
            const isOldCustomer = document.getElementById('oldCustomer').checked;
            const count = selectedDresses.length;
            if (count === 0) { document.getElementById('priceSummary').innerHTML = '<div class="price-row"><span>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î</span><span>-</span></div>'; return; }
            let subtotal = 0, depositTotal = 0, itemsHtml = '';
            selectedDresses.forEach(code => { const dress = dressData.find(d => d.code === code); const price = selectedDays === 1 ? dress.price1 : selectedDays === 3 ? dress.price3 : dress.price5; subtotal += price; depositTotal += dress.price3; itemsHtml += '<div class="price-row"><span>' + dress.code + ' (' + selectedDays + ' ‡∏ß‡∏±‡∏ô)</span><span>' + price + ' ‡∏ö‡∏≤‡∏ó</span></div>'; });
            let discount = 0, discountHtml = '';
            if (count >= 3) { const d10 = Math.round(subtotal * 0.10); discount += d10; discountHtml += '<div class="price-row discount"><span>‡∏•‡∏î 10% (3 ‡∏ä‡∏∏‡∏î)</span><span>-' + d10 + ' ‡∏ö‡∏≤‡∏ó</span></div>'; }
            if (isOldCustomer) { const d5 = Math.round(subtotal * 0.05); discount += d5; discountHtml += '<div class="price-row discount"><span>‡∏•‡∏î‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Å‡πà‡∏≤ 5%</span><span>-' + d5 + ' ‡∏ö‡∏≤‡∏ó</span></div>'; }
            const shipping = count >= 2 ? 0 : 35;
            const rentalTotal = subtotal - discount + shipping;
            const grandTotal = rentalTotal + depositTotal;
            document.getElementById('priceSummary').innerHTML = itemsHtml + discountHtml + '<div class="price-row"><span>‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á</span><span>' + (shipping === 0 ? '‡∏ü‡∏£‡∏µ' : shipping + ' ‡∏ö‡∏≤‡∏ó') + '</span></div><div class="price-row subtotal"><span>‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤</span><span>' + rentalTotal + ' ‡∏ö‡∏≤‡∏ó</span></div><div class="price-row deposit"><span>‡∏Ñ‡πà‡∏≤‡∏°‡∏±‡∏î‡∏à‡∏≥</span><span>' + depositTotal + ' ‡∏ö‡∏≤‡∏ó</span></div><div class="price-row total"><span>‡∏¢‡∏≠‡∏î‡πÇ‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span><span>' + grandTotal + ' ‡∏ö‡∏≤‡∏ó</span></div>';
        }

        function calculateDates() {
            const startDateInput = document.getElementById('startDate').value;
            if (!startDateInput) return;
            const startDate = new Date(startDateInput);
            const pickupDate = new Date(startDate); pickupDate.setDate(pickupDate.getDate() - 4);
            const endDate = new Date(startDate); endDate.setDate(endDate.getDate() + selectedDays - 1);
            const returnDate = new Date(endDate); returnDate.setDate(returnDate.getDate() + 1);
            document.getElementById('pickupDate').value = formatDateInput(pickupDate);
            document.getElementById('endDate').value = formatDateInput(endDate);
            document.getElementById('returnDate').value = formatDateInput(returnDate);
        }

        async function saveOrder() {
            const name = document.getElementById('customerName').value.trim();
            const phone = document.getElementById('customerPhone').value.trim();
            if (selectedDresses.length === 0) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î'); return; }
            if (!name) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤'); return; }
            if (!phone) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£'); return; }
            if (!document.getElementById('startDate').value) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏ä‡∏∏‡∏î'); return; }
            showNotification('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...');
            try {
                const params = new URLSearchParams({ action: 'book', dressCodes: selectedDresses.join(','), startDate: document.getElementById('startDate').value, days: selectedDays, customerName: name, phone: phone, lineId: document.getElementById('customerLine').value, address: document.getElementById('customerAddress').value, isOldCustomer: document.getElementById('oldCustomer').checked });
                const response = await fetch(API_URL + '?' + params);
                const result = await response.json();
                if (result.success) {
                    showNotification('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                    loadOrders();
                    selectedDresses = [];
                    document.getElementById('customerName').value = '';
                    document.getElementById('customerPhone').value = '';
                    document.getElementById('customerLine').value = '';
                    document.getElementById('customerAddress').value = '';
                    document.getElementById('startDate').value = '';
                    document.getElementById('pickupDate').value = '';
                    document.getElementById('endDate').value = '';
                    document.getElementById('returnDate').value = '';
                    document.getElementById('oldCustomer').checked = false;
                    updateUI();
                } else { alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + result.error); }
            } catch (error) { console.error(error); alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ'); }
        }

        function getOrderData() {
            const count = selectedDresses.length;
            const isOldCustomer = document.getElementById('oldCustomer').checked;
            let subtotal = 0, depositTotal = 0;
            selectedDresses.forEach(code => { const dress = dressData.find(d => d.code === code); const price = selectedDays === 1 ? dress.price1 : selectedDays === 3 ? dress.price3 : dress.price5; subtotal += price; depositTotal += dress.price3; });
            let discount = 0;
            if (count >= 3) discount += Math.round(subtotal * 0.10);
            if (isOldCustomer) discount += Math.round(subtotal * 0.05);
            const shipping = count >= 2 ? 0 : 35;
            const rentalTotal = subtotal - discount + shipping;
            const grandTotal = rentalTotal + depositTotal;
            return { dresses: selectedDresses.map(code => dressData.find(d => d.code === code)), days: selectedDays, name: document.getElementById('customerName').value, phone: document.getElementById('customerPhone').value, line: document.getElementById('customerLine').value, address: document.getElementById('customerAddress').value, startDate: document.getElementById('startDate').value, pickupDate: document.getElementById('pickupDate').value, endDate: document.getElementById('endDate').value, returnDate: document.getElementById('returnDate').value, subtotal: subtotal, discount: discount, shipping: shipping, rentalTotal: rentalTotal, depositTotal: depositTotal, grandTotal: grandTotal, isOldCustomer: isOldCustomer };
        }

        function generateSummary() {
            if (selectedDresses.length === 0) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î'); return; }
            const data = getOrderData();
            let dressLines = '';
            data.dresses.forEach(d => { const price = selectedDays === 1 ? d.price1 : selectedDays === 3 ? d.price3 : d.price5; dressLines += '   - ' + d.code + ' - ' + d.name + ' (' + selectedDays + ' ‡∏ß‡∏±‡∏ô) = ' + price + ' ‡∏ö‡∏≤‡∏ó\n'; });
            const summary = 'Rental For You\n================\n\n‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤\n   ‡∏ä‡∏∑‡πà‡∏≠: ' + (data.name || '-') + '\n   ‡πÄ‡∏ö‡∏≠‡∏£‡πå: ' + (data.phone || '-') + '\n   Line: ' + (data.line || '-') + '\n\n‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á\n' + (data.address || '-') + '\n\n‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πà‡∏≤\n' + dressLines + '   ‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á = ' + (data.shipping === 0 ? '‡∏ü‡∏£‡∏µ!' : data.shipping + ' ‡∏ö‡∏≤‡∏ó') + '\n\n================\n‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤ = ' + data.rentalTotal + ' ‡∏ö‡∏≤‡∏ó\n‡∏Ñ‡πà‡∏≤‡∏°‡∏±‡∏î‡∏à‡∏≥ = ' + data.depositTotal + ' ‡∏ö‡∏≤‡∏ó\n================\n‡∏¢‡∏≠‡∏î‡πÇ‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î = ' + data.grandTotal + ' ‡∏ö‡∏≤‡∏ó\n================\n\n‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£\n   ‡∏™‡πà‡∏á‡∏ä‡∏∏‡∏î: ' + formatThaiDate(data.pickupDate) + '\n   ‡∏ß‡∏±‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: ' + formatThaiDate(data.startDate) + ' - ' + formatThaiDate(data.endDate) + '\n   ‡∏™‡πà‡∏á‡∏Ñ‡∏∑‡∏ô: ' + formatThaiDate(data.returnDate) + '\n\n‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏∞';
            document.getElementById('orderSummaryBox').style.display = 'block';
            document.getElementById('orderSummaryBox').textContent = summary;
        }

        function copySummary() { const text = document.getElementById('orderSummaryBox').textContent; if (!text) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡πà‡∏≠‡∏ô'); return; } copyToClipboard(text); }

        function printLabelLandscape() {
            if (selectedDresses.length === 0) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î'); return; }
            const data = getOrderData();
            const shopName = document.getElementById('shopName').value || 'Rental For You';
            const shopPhone = document.getElementById('shopPhone').value || '-';
            const shopAddress = document.getElementById('shopAddress').value || '-';
            const labelHtml = '<div class="print-page-landscape"><div class="label-half"><div class="label-header"><span class="label-type-badge send">‡∏™‡πà‡∏á‡∏ä‡∏∏‡∏î‡πÑ‡∏õ‡∏´‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</span></div><div class="label-body"><div class="address-section"><div class="address-box"><div class="address-box-title">‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á</div><h3>' + shopName + '</h3><div class="phone">‡πÇ‡∏ó‡∏£ ' + shopPhone + '</div><div class="addr">' + shopAddress + '</div></div><div class="address-box highlight-blue"><div class="address-box-title">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö</div><h3>' + data.name + '</h3><div class="phone">‡πÇ‡∏ó‡∏£ ' + data.phone + '</div><div class="addr">' + (data.address || '-') + '</div></div></div><div class="info-section"><div class="info-box"><div class="info-row"><strong>‡∏ä‡∏∏‡∏î:</strong> <span>' + selectedDresses.join(', ') + '</span></div><div class="info-row"><strong>‡∏ß‡∏±‡∏ô‡πÉ‡∏ä‡πâ:</strong> <span>' + formatThaiDate(data.startDate) + '</span></div><div class="info-row"><strong>‡∏ñ‡∏∂‡∏á:</strong> <span>' + formatThaiDate(data.endDate) + '</span></div><div class="info-row highlight"><strong>‡∏™‡πà‡∏á‡∏Ñ‡∏∑‡∏ô:</strong> <span>' + formatThaiDate(data.returnDate) + '</span></div></div><div class="brand-box"><div class="brand-logo">Rental <span>For You</span></div><div class="brand-contact">IG: rental_foru<br>Line: @897pymlg</div></div></div></div><div class="cut-indicator">‡∏ï‡∏±‡∏î‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ</div></div><div class="label-half return"><div class="label-header return"><span class="label-type-badge return">‡∏™‡πà‡∏á‡∏Ñ‡∏∑‡∏ô‡∏£‡πâ‡∏≤‡∏ô (‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÅ‡∏õ‡∏∞‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö)</span></div><div class="label-body"><div class="address-section"><div class="address-box"><div class="address-box-title">‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á (‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤)</div><h3>' + data.name + '</h3><div class="phone">‡πÇ‡∏ó‡∏£ ' + data.phone + '</div><div class="addr">' + (data.address || '-') + '</div></div><div class="address-box highlight-red"><div class="address-box-title">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö (‡∏£‡πâ‡∏≤‡∏ô)</div><h3>' + shopName + '</h3><div class="phone">‡πÇ‡∏ó‡∏£ ' + shopPhone + '</div><div class="addr">' + shopAddress + '</div></div></div><div class="info-section"><div class="info-box"><div class="info-row"><strong>‡∏ä‡∏∏‡∏î:</strong> <span>' + selectedDresses.join(', ') + '</span></div><div class="info-row"><strong>‡∏à‡∏≤‡∏Å:</strong> <span>' + data.name + '</span></div><div class="info-row highlight"><strong>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡πà‡∏á‡∏Ñ‡∏∑‡∏ô‡∏†‡∏≤‡∏¢‡πÉ‡∏ô:</strong> <span>' + formatThaiDate(data.returnDate) + '</span></div></div><div class="brand-box"><div class="brand-logo">Rental <span>For You</span></div><div class="brand-contact">IG: rental_foru<br>Line: @897pymlg</div></div></div></div></div></div>';
            document.getElementById('printArea').innerHTML = labelHtml;
            window.print();
        }

        async function loadOrders() {
            try {
                const response = await fetch(API_URL + '?action=getOrders');
                const result = await response.json();
                if (result.success) { allOrdersData = result.orders || []; renderDashboard(); renderAllOrders(); renderShippingSchedule(); }
            } catch (error) { console.error('Error loading orders:', error); }
        }
        function refreshData() { loadOrders(); loadCalendarBlocks(); showNotification('‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß'); }

        function renderDashboard() {
            const today = new Date(); today.setHours(0,0,0,0);
            const twoDaysLater = new Date(today); twoDaysLater.setDate(twoDaysLater.getDate() + 2);
            let pending = 0, confirmed = 0, shipped = 0, returnSoon = 0;
            let todayShipHtml = '', returnAlertHtml = '';
            allOrdersData.forEach(order => {
                if (order.status === '‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞') pending++;
                else if (order.status === '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß') confirmed++;
                else if (order.status === '‡∏™‡πà‡∏á‡∏ä‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß') shipped++;
                const pickupDate = new Date(order.pickupDate);
                if (pickupDate.getTime() === today.getTime() && (order.status === '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß')) { todayShipHtml += '<div class="alert warning">' + (order.code || order.dressCode) + ' - ' + order.customerName + ' (' + order.phone + ')</div>'; }
                const returnDate = new Date(order.returnDate);
                if (order.status === '‡∏™‡πà‡∏á‡∏ä‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß' && returnDate <= twoDaysLater && returnDate >= today) { returnSoon++; const daysLeft = Math.ceil((returnDate - today) / (1000 * 60 * 60 * 24)); returnAlertHtml += '<div class="alert ' + (daysLeft === 0 ? 'danger' : 'warning') + '">' + (order.code || order.dressCode) + ' - ' + order.customerName + ' ‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏á‡∏Ñ‡∏∑‡∏ô' + (daysLeft === 0 ? '‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ!' : '‡∏≠‡∏µ‡∏Å ' + daysLeft + ' ‡∏ß‡∏±‡∏ô') + '</div>'; }
            });
            document.getElementById('statPending').textContent = pending;
            document.getElementById('statConfirmed').textContent = confirmed;
            document.getElementById('statShipped').textContent = shipped;
            document.getElementById('statReturn').textContent = returnSoon;
            document.getElementById('todayShipments').innerHTML = todayShipHtml || '<div class="alert success">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>';
            document.getElementById('returnAlerts').innerHTML = returnAlertHtml || '<div class="alert success">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ñ‡∏∑‡∏ô</div>';
            const recent = allOrdersData.slice(0, 5);
            document.getElementById('recentOrders').innerHTML = recent.length ? recent.map(o => '<tr><td>' + (o.id || '-') + '</td><td>' + o.customerName + '</td><td>' + o.dressCode + '</td><td>' + formatThaiDate(o.startDate) + ' - ' + formatThaiDate(o.endDate) + '</td><td>' + (o.total || '-') + '</td><td><span class="status-badge status-' + getStatusClass(o.status) + '">' + o.status + '</span></td></tr>').join('') : '<tr><td colspan="6" style="text-align:center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</td></tr>';
        }

        function renderAllOrders() {
            const tbody = document.getElementById('allOrders');
            tbody.innerHTML = allOrdersData.length ? allOrdersData.map(o => '<tr><td>' + (o.id || '-') + '</td><td>' + o.customerName + '<br><small>' + o.phone + '</small></td><td>' + o.dressCode + '</td><td>' + formatThaiDate(o.pickupDate) + '</td><td>' + formatThaiDate(o.startDate) + '</td><td>' + formatThaiDate(o.returnDate) + '</td><td>' + (o.total || '-') + '</td><td><span class="status-badge status-' + getStatusClass(o.status) + '">' + o.status + '</span></td><td><button class="action-btn edit" onclick="updateStatus(\'' + o.id + '\')">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</button></td></tr>').join('') : '<tr><td colspan="9" style="text-align:center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</td></tr>';
        }

        function filterOrders() {
            const status = document.getElementById('filterStatus').value;
            const search = document.getElementById('searchOrder').value.toLowerCase();
            let filtered = allOrdersData.filter(o => { if (status && o.status !== status) return false; if (search) { const searchStr = (o.customerName + ' ' + o.phone + ' ' + o.dressCode).toLowerCase(); if (searchStr.indexOf(search) === -1) return false; } return true; });
            const tbody = document.getElementById('allOrders');
            tbody.innerHTML = filtered.length ? filtered.map(o => '<tr><td>' + (o.id || '-') + '</td><td>' + o.customerName + '<br><small>' + o.phone + '</small></td><td>' + o.dressCode + '</td><td>' + formatThaiDate(o.pickupDate) + '</td><td>' + formatThaiDate(o.startDate) + '</td><td>' + formatThaiDate(o.returnDate) + '</td><td>' + (o.total || '-') + '</td><td><span class="status-badge status-' + getStatusClass(o.status) + '">' + o.status + '</span></td><td><button class="action-btn edit" onclick="updateStatus(\'' + o.id + '\')">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</button></td></tr>').join('') : '<tr><td colspan="9" style="text-align:center">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</td></tr>';
        }

        async function updateStatus(orderId) {
            const newStatus = prompt('‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏´‡∏°‡πà:\n1 = ‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞\n2 = ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß\n3 = ‡∏™‡πà‡∏á‡∏ä‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß\n4 = ‡∏Ñ‡∏∑‡∏ô‡∏ä‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß\n5 = ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å');
            const statusMap = {'1':'‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞','2':'‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß','3':'‡∏™‡πà‡∏á‡∏ä‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß','4':'‡∏Ñ‡∏∑‡∏ô‡∏ä‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß','5':'‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'};
            if (newStatus && statusMap[newStatus]) {
                try { const response = await fetch(API_URL + '?action=updateStatus&orderId=' + orderId + '&status=' + statusMap[newStatus]); const result = await response.json(); if (result.success) { showNotification('‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢'); loadOrders(); } } catch (e) { alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î'); }
            }
        }

        function renderShippingSchedule() {
            const today = new Date();
            let shipHtml = '', returnHtml = '';
            for (let i = 0; i < 7; i++) {
                const date = new Date(today); date.setDate(date.getDate() + i);
                const dateStr = formatDateInput(date);
                const shipOrders = allOrdersData.filter(o => o.pickupDate === dateStr && o.status === '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß');
                const returnOrders = allOrdersData.filter(o => o.returnDate === dateStr && o.status === '‡∏™‡πà‡∏á‡∏ä‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß');
                shipHtml += '<div style="margin-bottom:15px;padding:15px;background:' + (shipOrders.length ? '#FFF3E0' : 'var(--cream)') + ';border-radius:10px"><strong>' + formatThaiDate(dateStr) + (i === 0 ? ' (‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ)' : i === 1 ? ' (‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ)' : '') + '</strong>' + (shipOrders.length ? shipOrders.map(o => '<div style="margin-top:8px">' + o.dressCode + ' ‚Üí ' + o.customerName + ' (' + o.phone + ')</div>').join('') : '<div style="color:var(--brown-light);margin-top:5px">‡πÑ‡∏°‡πà‡∏°‡∏µ</div>') + '</div>';
                returnHtml += '<div style="margin-bottom:15px;padding:15px;background:' + (returnOrders.length ? '#FFEBEE' : 'var(--cream)') + ';border-radius:10px"><strong>' + formatThaiDate(dateStr) + (i === 0 ? ' (‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ)' : i === 1 ? ' (‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ)' : '') + '</strong>' + (returnOrders.length ? returnOrders.map(o => '<div style="margin-top:8px">' + o.dressCode + ' ‚Üê ' + o.customerName + ' (' + o.phone + ')</div>').join('') : '<div style="color:var(--brown-light);margin-top:5px">‡πÑ‡∏°‡πà‡∏°‡∏µ</div>') + '</div>';
            }
            document.getElementById('shippingSchedule').innerHTML = shipHtml;
            document.getElementById('returnSchedule').innerHTML = returnHtml;
        }

        function loadShopInfo() { const shopName = localStorage.getItem('shopName'); const shopPhone = localStorage.getItem('shopPhone'); const shopAddress = localStorage.getItem('shopAddress'); if (shopName) document.getElementById('shopName').value = shopName; if (shopPhone) document.getElementById('shopPhone').value = shopPhone; if (shopAddress) document.getElementById('shopAddress').value = shopAddress; }
        function saveShopInfo() { localStorage.setItem('shopName', document.getElementById('shopName').value); localStorage.setItem('shopPhone', document.getElementById('shopPhone').value); localStorage.setItem('shopAddress', document.getElementById('shopAddress').value); showNotification('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢'); }
        function changePassword() { const newPass = document.getElementById('newPassword').value; const confirmPass = document.getElementById('confirmPassword').value; if (!newPass) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà'); return; } if (newPass !== confirmPass) { alert('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô'); return; } if (newPass.length < 4) { alert('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 4 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£'); return; } localStorage.setItem('adminPassword', newPass); showNotification('‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢'); document.getElementById('newPassword').value = ''; document.getElementById('confirmPassword').value = ''; }
        function formatDateInput(date) { return date.toISOString().split('T')[0]; }
        function formatThaiDate(dateStr) { if (!dateStr) return '-'; const months = ['‡∏°.‡∏Ñ.','‡∏Å.‡∏û.','‡∏°‡∏µ.‡∏Ñ.','‡πÄ‡∏°.‡∏¢.','‡∏û.‡∏Ñ.','‡∏°‡∏¥.‡∏¢.','‡∏Å.‡∏Ñ.','‡∏™.‡∏Ñ.','‡∏Å.‡∏¢.','‡∏ï.‡∏Ñ.','‡∏û.‡∏¢.','‡∏ò.‡∏Ñ.']; const date = new Date(dateStr); return date.getDate() + ' ' + months[date.getMonth()] + ' ' + (date.getFullYear() + 543); }
        function getStatusClass(status) { const map = {'‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞':'pending','‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß':'confirmed','‡∏™‡πà‡∏á‡∏ä‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß':'shipped','‡∏Ñ‡∏∑‡∏ô‡∏ä‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß':'returned','‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å':'cancelled'}; return map[status] || 'pending'; }
        function copyToClipboard(text) { navigator.clipboard.writeText(text).then(function() { showNotification('Copy ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!'); }); }
        function showNotification(msg) { const el = document.getElementById('copyNotification'); el.textContent = msg; el.style.display = 'block'; setTimeout(function() { el.style.display = 'none'; }, 2000); }
        
        // ==================== CALENDAR MANAGEMENT ====================
        function initCalendarPage() {
            const select = document.getElementById('blockDressCode');
            select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î...</option>' + dressData.map(d => 
                '<option value="' + d.code + '">' + d.code + ' - ' + d.name + '</option>'
            ).join('');
        }

        async function loadCalendarBlocks() {
            try {
                const response = await fetch(API_URL + '?action=getCalendarBlocks');
                const result = await response.json();
                if (result.success) {
                    allBlocks = result.blocks || [];
                    renderCalendarBlocks();
                }
            } catch (error) {
                console.error('Error loading blocks:', error);
                document.getElementById('calendarBlocksList').innerHTML = '<tr><td colspan="7" style="text-align:center;color:var(--red)">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
            }
        }

        function renderCalendarBlocks() {
            const tbody = document.getElementById('calendarBlocksList');
            if (!allBlocks || allBlocks.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;padding:40px;color:var(--brown-light)">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô</td></tr>';
                return;
            }
            
            tbody.innerHTML = allBlocks.map(b => {
                const start = new Date(b.startDate);
                const end = new Date(b.endDate);
                const days = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
                
                return '<tr>' +
                    '<td><strong>' + b.id + '</strong></td>' +
                    '<td><strong style="color:var(--gold)">' + b.dressCode + '</strong></td>' +
                    '<td>' + formatThaiDate(b.startDate) + '</td>' +
                    '<td>' + formatThaiDate(b.endDate) + '</td>' +
                    '<td>' + days + ' ‡∏ß‡∏±‡∏ô</td>' +
                    '<td><span class="status-badge ' + getBlockTypeClass(b.type) + '">' + b.type + '</span></td>' +
                    '<td><button class="action-btn edit" style="background:var(--red)" onclick="deleteBlock(\'' + b.id + '\')">‡∏•‡∏ö</button></td>' +
                '</tr>';
            }).join('');
        }

        function getBlockTypeClass(type) {
            if (type === '‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå') return 'status-confirmed';
            if (type === '‡∏ã‡πà‡∏≠‡∏°‡∏ä‡∏∏‡∏î') return 'status-cancelled';
            if (type === '‡∏ã‡∏±‡∏Å‡πÅ‡∏´‡πâ‡∏á') return 'status-pending';
            if (type === '‡∏à‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß') return 'status-shipped';
            return 'status-pending';
        }

        async function addNewBlock() {
            const dressCode = document.getElementById('blockDressCode').value;
            const startDate = document.getElementById('blockStartDate').value;
            const endDate = document.getElementById('blockEndDate').value;
            const type = document.getElementById('blockType').value;
            
            if (!dressCode) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î');
                return;
            }
            
            if (!startDate || !endDate) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î');
                return;
            }
            
            if (new Date(endDate) < new Date(startDate)) {
                alert('‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô');
                return;
            }
            
            showNotification('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ö‡∏•‡πá‡∏≠‡∏Å...');
            
            try {
                const params = new URLSearchParams({
                    action: 'addCalendarBlock',
                    dressCode: dressCode,
                    startDate: startDate,
                    endDate: endDate,
                    type: type
                });
                
                const response = await fetch(API_URL + '?' + params);
                const result = await response.json();
                
                if (result.success) {
                    showNotification('‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                    document.getElementById('blockStartDate').value = '';
                    document.getElementById('blockEndDate').value = '';
                    document.getElementById('blockDressCode').selectedIndex = 0;
                    loadCalendarBlocks();
                } else {
                    alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + result.error);
                }
            } catch (error) {
                console.error(error);
                alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ');
            }
        }

        async function deleteBlock(blockId) {
            const block = allBlocks.find(b => b.id === blockId);
            const confirmMsg = '‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\n\n' +
                '‡∏£‡∏´‡∏±‡∏™‡∏ä‡∏∏‡∏î: ' + (block ? block.dressCode : '') + '\n' +
                '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ' + (block ? block.type : '') + '\n' +
                '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ' + (block ? formatThaiDate(block.startDate) + ' - ' + formatThaiDate(block.endDate) : '');
            
            if (!confirm(confirmMsg)) return;
            
            showNotification('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö...');
            
            try {
                const response = await fetch(API_URL + '?action=deleteCalendarBlock&id=' + blockId);
                const result = await response.json();
                
                if (result.success) {
                    showNotification('‚úÖ ‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                    loadCalendarBlocks();
                } else {
                    alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + result.error);
                }
            } catch (error) {
                console.error(error);
                alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ');
            }
        }
        
        checkLogin();
    </script>
</body>
</html>
