<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Rental For You</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root{--bg-dark:#1a1a1a;--bg-card:#242424;--bg-hover:#2d2d2d;--text-primary:#f5f5f5;--text-secondary:#a0a0a0;--text-muted:#666;--accent:#c9a962;--accent-hover:#d4b872;--success:#4ade80;--warning:#fbbf24;--danger:#f87171;--info:#60a5fa;--border:#333}*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Prompt',sans-serif;background:var(--bg-dark);color:var(--text-primary);min-height:100vh}.header{background:var(--bg-card);border-bottom:1px solid var(--border);padding:15px 30px;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:100}.logo{font-size:1.3rem;font-weight:600;display:flex;align-items:center;gap:10px}.logo-icon{width:35px;height:35px;background:var(--accent);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:1.2rem}.logo span{color:var(--accent)}.nav-tabs{display:flex;gap:5px;background:var(--bg-card);padding:10px 30px;border-bottom:1px solid var(--border);overflow-x:auto}.nav-tab{padding:12px 24px;background:transparent;border:none;color:var(--text-secondary);font-family:'Prompt',sans-serif;font-size:.9rem;font-weight:500;cursor:pointer;border-radius:8px;transition:all .2s;white-space:nowrap}.nav-tab:hover{background:var(--bg-hover);color:var(--text-primary)}.nav-tab.active{background:var(--accent);color:var(--bg-dark)}.main{padding:30px;max-width:1600px;margin:0 auto}.page{display:none;animation:fadeIn .3s}.page.active{display:block}@keyframes fadeIn{from{opacity:0}to{opacity:1}}.card{background:var(--bg-card);border-radius:12px;border:1px solid var(--border);overflow:hidden;margin-bottom:20px}.card-header{padding:20px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px}.card-title{font-size:1.1rem;font-weight:600}.card-body{padding:20px}.btn{padding:10px 20px;border:none;border-radius:8px;font-family:'Prompt',sans-serif;font-size:.9rem;font-weight:500;cursor:pointer;transition:all .2s;display:inline-flex;align-items:center;gap:8px}.btn-primary{background:var(--accent);color:var(--bg-dark)}.btn-primary:hover{background:var(--accent-hover)}.btn-secondary{background:var(--bg-hover);color:var(--text-primary);border:1px solid var(--border)}.btn-danger{background:var(--danger);color:#fff}.btn-success{background:var(--success);color:var(--bg-dark)}.btn-info{background:var(--info);color:#fff}.btn-sm{padding:6px 12px;font-size:.8rem}.btn-toggle{background:var(--bg-hover);color:var(--text-secondary);border:2px solid var(--border)}.btn-toggle:hover{border-color:var(--accent);color:var(--text-primary)}.btn-toggle.active{background:var(--accent);color:var(--bg-dark);border-color:var(--accent)}.form-group{margin-bottom:20px}.form-label{display:block;font-size:.85rem;font-weight:500;color:var(--text-secondary);margin-bottom:8px}.form-input,.form-select{width:100%;padding:12px 15px;background:var(--bg-dark);border:1px solid var(--border);border-radius:8px;color:var(--text-primary);font-family:'Prompt',sans-serif;font-size:.95rem}.form-input:focus,.form-select:focus{outline:none;border-color:var(--accent)}.form-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px}.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:20px;margin-bottom:30px}.stat-card{background:var(--bg-card);border-radius:12px;border:1px solid var(--border);padding:20px}.stat-icon{width:45px;height:45px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.3rem;margin-bottom:15px}.stat-icon.gold{background:rgba(201,169,98,.2)}.stat-icon.green{background:rgba(74,222,128,.2)}.stat-icon.blue{background:rgba(96,165,250,.2)}.stat-icon.red{background:rgba(248,113,113,.2)}.stat-icon.orange{background:rgba(251,191,36,.2)}.stat-value{font-size:1.8rem;font-weight:700;font-family:'Space Mono',monospace}.stat-label{font-size:.85rem;color:var(--text-secondary);margin-top:5px}.calendar-container{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px}.calendar-card{background:var(--bg-card);border-radius:12px;border:1px solid var(--border);overflow:hidden}.calendar-card-header{padding:15px;background:var(--bg-hover);border-bottom:1px solid var(--border)}.calendar-card-title{font-weight:600}.calendar-card-title .code{font-family:'Space Mono',monospace;font-size:.85rem;color:var(--accent);margin-right:8px}.calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:2px;padding:10px}.calendar-header-day{text-align:center;font-size:.7rem;font-weight:600;color:var(--text-muted);padding:8px 0}.calendar-day{aspect-ratio:1;display:flex;align-items:center;justify-content:center;font-size:.8rem;border-radius:6px;background:var(--bg-dark)}.calendar-day.empty{background:transparent}.calendar-day.past{color:var(--text-muted);opacity:.5}.calendar-day.today{border:2px solid var(--accent)}.calendar-day.booked{background:var(--danger);color:#fff}.calendar-nav{display:flex;justify-content:space-between;align-items:center;padding:15px 20px;background:var(--bg-dark);margin-bottom:20px;border-radius:10px}.calendar-nav-btn{width:35px;height:35px;border:none;background:var(--bg-hover);color:var(--text-primary);border-radius:6px;cursor:pointer;font-size:1rem}.calendar-nav-btn:hover{background:var(--accent);color:var(--bg-dark)}.calendar-month-year{font-weight:600}.calendar-legend{display:flex;gap:20px;padding:15px;background:var(--bg-card);border-radius:10px;margin-bottom:20px;flex-wrap:wrap}.legend-item{display:flex;align-items:center;gap:8px;font-size:.85rem;color:var(--text-secondary)}.legend-dot{width:16px;height:16px;border-radius:4px}.legend-dot.available{background:var(--bg-dark);border:1px solid var(--border)}.legend-dot.booked{background:var(--danger)}.block-form{background:var(--bg-card);border-radius:12px;border:1px solid var(--border);padding:25px;margin-bottom:20px}.block-form-title{font-size:1.1rem;font-weight:600;margin-bottom:20px}.blocks-list{max-height:400px;overflow-y:auto}.block-item{display:flex;justify-content:space-between;align-items:center;padding:15px;background:var(--bg-dark);border-radius:8px;margin-bottom:10px}.block-code{font-family:'Space Mono',monospace;color:var(--accent);font-weight:600}.block-dates{font-size:.85rem;color:var(--text-secondary);margin-top:4px}.block-type{font-size:.75rem;padding:3px 8px;border-radius:4px;margin-left:10px}.block-type.order{background:var(--info);color:#fff}.block-type.custom{background:var(--warning);color:var(--bg-dark)}.calculator-card{background:linear-gradient(135deg,var(--bg-card) 0%,#2a2520 100%);border:1px solid var(--accent)}.price-result{background:var(--bg-dark);border-radius:10px;padding:20px;margin-top:20px}.price-row{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid var(--border)}.price-row:last-child{border-bottom:none}.price-row.total{font-size:1.2rem;font-weight:700;color:var(--accent);border-top:2px solid var(--accent);margin-top:10px;padding-top:15px}.price-label{color:var(--text-secondary)}.price-value{font-weight:600;font-family:'Space Mono',monospace}.dress-selector{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:10px;max-height:250px;overflow-y:auto;padding:10px;background:var(--bg-dark);border-radius:8px}.dress-option{padding:10px;background:var(--bg-hover);border:2px solid transparent;border-radius:8px;cursor:pointer;text-align:center;transition:all .2s}.dress-option:hover{border-color:var(--border)}.dress-option.selected{border-color:var(--accent);background:rgba(201,169,98,.1)}.dress-option-code{font-family:'Space Mono',monospace;font-weight:600;color:var(--accent);font-size:.9rem}.dress-option-name{font-size:.75rem;color:var(--text-secondary);margin-top:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.dress-tags{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}.dress-tag{background:var(--bg-hover);padding:6px 12px;border-radius:20px;font-size:.85rem;display:flex;align-items:center;gap:8px}.dress-tag .remove{cursor:pointer;color:var(--danger);font-weight:700}.promo-card{background:var(--bg-card);border:1px solid var(--border);border-radius:12px;margin-bottom:15px}.promo-item{display:flex;align-items:center;justify-content:space-between;padding:20px;gap:15px;flex-wrap:wrap}.promo-info{flex:1;min-width:200px}.promo-name{font-weight:600;margin-bottom:5px}.promo-desc{font-size:.85rem;color:var(--text-secondary)}.promo-controls{display:flex;align-items:center;gap:15px;flex-wrap:wrap}.promo-value{display:flex;align-items:center;gap:8px}.promo-value input{width:70px;padding:8px;text-align:center;background:var(--bg-dark);border:1px solid var(--border);border-radius:6px;color:var(--text-primary);font-family:'Space Mono',monospace}.promo-value input:focus{outline:none;border-color:var(--accent)}.promo-unit{font-size:.9rem;color:var(--text-secondary)}.toggle-switch{position:relative;width:50px;height:26px}.toggle-switch input{opacity:0;width:0;height:0}.toggle-slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:var(--bg-dark);transition:.3s;border-radius:26px;border:1px solid var(--border)}.toggle-slider:before{position:absolute;content:"";height:18px;width:18px;left:3px;bottom:3px;background-color:var(--text-secondary);transition:.3s;border-radius:50%}.toggle-switch input:checked+.toggle-slider{background-color:var(--accent);border-color:var(--accent)}.toggle-switch input:checked+.toggle-slider:before{transform:translateX(24px);background-color:var(--bg-dark)}.extra-discounts{margin-top:15px}.extra-discount-item{display:flex;align-items:center;gap:10px;padding:12px;background:var(--bg-dark);border-radius:8px;margin-bottom:10px;flex-wrap:wrap}.extra-discount-item input[type=text]{flex:1;min-width:120px;padding:8px 12px;background:var(--bg-hover);border:1px solid var(--border);border-radius:6px;color:var(--text-primary);font-family:'Prompt',sans-serif}.extra-discount-item input[type=number]{width:70px;padding:8px;text-align:center;background:var(--bg-hover);border:1px solid var(--border);border-radius:6px;color:var(--text-primary);font-family:'Space Mono',monospace}.extra-discount-item select{padding:8px 12px;background:var(--bg-hover);border:1px solid var(--border);border-radius:6px;color:var(--text-primary);font-family:'Prompt',sans-serif}.active-promos{background:rgba(201,169,98,.1);border:1px solid var(--accent);border-radius:10px;padding:15px;margin-bottom:20px}.active-promos-title{font-size:.85rem;color:var(--accent);margin-bottom:10px;font-weight:600}.active-promo-tag{display:inline-block;background:var(--accent);color:var(--bg-dark);padding:4px 10px;border-radius:15px;font-size:.8rem;margin:3px;font-weight:500}.filter-bar{display:flex;gap:15px;margin-bottom:20px;flex-wrap:wrap}.filter-bar .form-input,.filter-bar .form-select{width:auto;min-width:150px}.orders-table{width:100%;border-collapse:collapse}.orders-table th,.orders-table td{padding:15px;text-align:left;border-bottom:1px solid var(--border)}.orders-table th{background:var(--bg-hover);color:var(--text-secondary);font-weight:600;font-size:.85rem;text-transform:uppercase}.orders-table tr:hover{background:var(--bg-hover)}.orders-table-wrapper{overflow-x:auto}.order-id{font-family:'Space Mono',monospace;color:var(--accent);font-weight:600}.order-customer{font-weight:500}.order-customer-phone{font-size:.85rem;color:var(--text-secondary)}.order-dresses{font-family:'Space Mono',monospace;font-size:.85rem}.order-dates{font-size:.85rem}.order-date-row{display:flex;align-items:center;gap:8px;margin:4px 0}.order-date-label{color:var(--text-muted);min-width:50px}.order-date-value{color:var(--text-primary)}.status-badge{display:inline-block;padding:5px 12px;border-radius:20px;font-size:.8rem;font-weight:500}.status-badge.pending{background:rgba(251,191,36,.2);color:var(--warning)}.status-badge.confirmed{background:rgba(96,165,250,.2);color:var(--info)}.status-badge.shipped{background:rgba(168,85,247,.2);color:#a855f7}.status-badge.returned{background:rgba(74,222,128,.2);color:var(--success)}.status-badge.cancelled{background:rgba(248,113,113,.2);color:var(--danger)}.order-actions{display:flex;gap:8px;flex-wrap:wrap}.modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.7);display:none;align-items:center;justify-content:center;z-index:1000;padding:20px}.modal-overlay.active{display:flex}.modal-content{background:var(--bg-card);border-radius:16px;max-width:600px;width:100%;max-height:90vh;overflow-y:auto}.modal-header{padding:25px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}.modal-body{padding:25px}.modal-section{margin-bottom:25px}.modal-section-title{font-size:.85rem;color:var(--accent);text-transform:uppercase;letter-spacing:1px;margin-bottom:15px;font-weight:600}.modal-row{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid var(--border)}.modal-label{color:var(--text-secondary)}.modal-value{font-weight:500;text-align:right}.close-btn{background:none;border:none;color:var(--text-secondary);font-size:1.5rem;cursor:pointer}.close-btn:hover{color:var(--text-primary)}.timeline{display:flex;justify-content:space-between;background:var(--bg-dark);border-radius:10px;padding:20px 15px;position:relative}.timeline::before{content:'';position:absolute;top:35px;left:50px;right:50px;height:2px;background:var(--border)}.timeline-point{text-align:center;position:relative;z-index:1;flex:1}.timeline-dot{width:30px;height:30px;border-radius:50%;background:var(--bg-card);border:2px solid var(--border);margin:0 auto 8px;display:flex;align-items:center;justify-content:center;font-size:.8rem}.timeline-dot.active{background:var(--accent);border-color:var(--accent)}.timeline-date{font-size:.7rem;color:var(--text-muted)}.timeline-label{font-size:.65rem;color:var(--text-secondary);margin-top:3px}.toast-container{position:fixed;bottom:30px;right:30px;z-index:1000}.toast{background:var(--bg-card);border:1px solid var(--border);border-radius:10px;padding:15px 20px;margin-top:10px;display:flex;align-items:center;gap:12px;animation:slideIn .3s;box-shadow:0 10px 30px rgba(0,0,0,.3)}@keyframes slideIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}.toast.success{border-left:4px solid var(--success)}.toast.error{border-left:4px solid var(--danger)}.toast.info{border-left:4px solid var(--info)}.loading{display:flex;align-items:center;justify-content:center;padding:40px;color:var(--text-secondary)}.spinner{width:30px;height:30px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin 1s linear infinite;margin-right:15px}@keyframes spin{to{transform:rotate(360deg)}}@media(max-width:768px){.header{padding:15px}.nav-tabs{padding:10px 15px}.main{padding:15px}.form-row{grid-template-columns:1fr}.calendar-container{grid-template-columns:1fr}.stats-grid{grid-template-columns:repeat(2,1fr)}.promo-item{flex-direction:column;align-items:flex-start}.orders-table th,.orders-table td{padding:10px;font-size:.85rem}}
    </style>
</head>
<body>
    <div class="header"><div class="logo"><div class="logo-icon">üëó</div><span>Rental</span> Admin</div><button class="btn btn-secondary" onclick="refreshAll()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button></div>
    <div class="nav-tabs">
        <button class="nav-tab active" onclick="showPage('orders',this)">üì¶ ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button>
        <button class="nav-tab" onclick="showPage('calendar',this)">üìÖ ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏£‡∏ß‡∏°</button>
        <button class="nav-tab" onclick="showPage('blocks',this)">üö´ ‡∏ö‡∏•‡πá‡∏≠‡∏Å/‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button class="nav-tab" onclick="showPage('calculator',this)">üßÆ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤</button>
        <button class="nav-tab" onclick="showPage('promo',this)">üéÅ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</button>
    </div>
    <div class="main">
        <div id="ordersPage" class="page active">
            <div class="stats-grid">
                <div class="stat-card"><div class="stat-icon gold">üì¶</div><div class="stat-value" id="statTotalOrders">-</div><div class="stat-label">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div></div>
                <div class="stat-card"><div class="stat-icon orange">‚è≥</div><div class="stat-value" id="statPendingOrders">-</div><div class="stat-label">‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞</div></div>
                <div class="stat-card"><div class="stat-icon blue">‚úÖ</div><div class="stat-value" id="statConfirmedOrders">-</div><div class="stat-label">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß</div></div>
                <div class="stat-card"><div class="stat-icon green">üì¨</div><div class="stat-value" id="statReturnedOrders">-</div><div class="stat-label">‡∏Ñ‡∏∑‡∏ô‡∏ä‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß</div></div>
            </div>
            <div class="card">
                <div class="card-header">
                    <div class="card-title">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div><button class="btn btn-primary btn-sm" onclick="openAddModal()" style="margin-left:15px">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button>
                    <div class="filter-bar" style="margin-bottom:0">
                        <input type="text" class="form-input" id="orderSearch" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." onkeyup="filterOrders()">
                        <select class="form-select" id="orderStatusFilter" onchange="filterOrders()"><option value="">‡∏ó‡∏∏‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option><option value="‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞">‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞</option><option value="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß</option><option value="‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß">‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß</option><option value="‡∏Ñ‡∏∑‡∏ô‡∏ä‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß">‡∏Ñ‡∏∑‡∏ô‡∏ä‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß</option><option value="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</option></select>
                    </div>
                </div>
                <div class="card-body">
                    <div class="orders-table-wrapper">
                        <table class="orders-table"><thead><tr><th>Order ID</th><th>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th><th>‡∏ä‡∏∏‡∏î</th><th>üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</th><th>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead><tbody id="ordersTableBody"><tr><td colspan="7"><div class="loading"><div class="spinner"></div> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div></td></tr></tbody></table>
                    </div>
                </div>
            </div>
        </div>
        <div id="calendarPage" class="page">
            <div class="stats-grid">
                <div class="stat-card"><div class="stat-icon gold">üëó</div><div class="stat-value" id="statTotal">-</div><div class="stat-label">‡∏ä‡∏∏‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div></div>
                <div class="stat-card"><div class="stat-icon green">‚úÖ</div><div class="stat-value" id="statAvailable">-</div><div class="stat-label">‡∏ß‡πà‡∏≤‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div></div>
                <div class="stat-card"><div class="stat-icon red">üìå</div><div class="stat-value" id="statBooked">-</div><div class="stat-label">‡∏ñ‡∏π‡∏Å‡∏à‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div></div>
                <div class="stat-card"><div class="stat-icon blue">üìã</div><div class="stat-value" id="statBlocks">-</div><div class="stat-label">‡∏Å‡∏≤‡∏£‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div></div>
            </div>
            <div class="calendar-nav"><button class="calendar-nav-btn" onclick="changeGlobalMonth(-1)">‚óÄ</button><span class="calendar-month-year" id="globalMonthYear"></span><button class="calendar-nav-btn" onclick="changeGlobalMonth(1)">‚ñ∂</button></div>
            <div class="calendar-legend"><div class="legend-item"><div class="legend-dot available"></div> ‡∏ß‡πà‡∏≤‡∏á</div><div class="legend-item"><div class="legend-dot booked"></div> ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á</div><div class="legend-item"><div class="legend-dot" style="border:2px solid var(--accent)"></div> ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div></div>
            <div class="filter-bar"><input type="text" class="form-input" id="calendarSearch" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∏‡∏î..." onkeyup="filterCalendars()"><select class="form-select" id="calendarBrandFilter" onchange="filterCalendars()"><option value="">‡∏ó‡∏∏‡∏Å‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå</option></select></div>
            <div class="calendar-container" id="calendarsGrid"><div class="loading"><div class="spinner"></div> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div></div>
        </div>
        <div id="blocksPage" class="page">
            <div class="form-row">
                <div class="block-form">
                    <div class="block-form-title">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏ß‡∏±‡∏ô</div>
                    <div class="form-group"><label class="form-label">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î</label><select class="form-select" id="blockDressCode"><option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î --</option></select></div>
                    <div class="form-row"><div class="form-group"><label class="form-label">‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ö‡∏•‡πá‡∏≠‡∏Å</label><input type="date" class="form-input" id="blockStartDate"></div><div class="form-group"><label class="form-label">‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ö‡∏•‡πá‡∏≠‡∏Å</label><input type="date" class="form-input" id="blockEndDate"></div></div>
                    <div class="form-group"><label class="form-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label><select class="form-select" id="blockType"><option value="‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á</option><option value="‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</option><option value="‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏°">‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏°</option><option value="‡∏ã‡∏±‡∏Å/‡∏£‡∏µ‡∏î">‡∏ã‡∏±‡∏Å/‡∏£‡∏µ‡∏î</option><option value="‡∏à‡∏≠‡∏á‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤">‡∏à‡∏≠‡∏á‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤</option></select></div>
                    <button class="btn btn-primary" onclick="addBlock()">üö´ ‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏ß‡∏±‡∏ô</button>
                </div>
                <div class="card" style="flex:1"><div class="card-header"><div class="card-title">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div><select class="form-select" style="width:auto" id="blockFilterType" onchange="filterBlocks()"><option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option><option value="‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</option><option value="‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á</option><option value="‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏°">‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏°</option><option value="‡∏ã‡∏±‡∏Å/‡∏£‡∏µ‡∏î">‡∏ã‡∏±‡∏Å/‡∏£‡∏µ‡∏î</option></select></div><div class="card-body"><div class="blocks-list" id="blocksList"><div class="loading"><div class="spinner"></div> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div></div></div></div>
            </div>
        </div>
        <div id="calculatorPage" class="page">
            <div class="active-promos"><div class="active-promos-title">üéÅ ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà</div><div id="activePromoTags"></div></div>
            <div class="form-row">
                <div class="card calculator-card">
                    <div class="card-header"><div class="card-title">üßÆ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏ä‡πà‡∏≤</div></div>
                    <div class="card-body">
                        <div class="form-group"><label class="form-label">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î (‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏ä‡∏∏‡∏î)</label><div class="dress-selector" id="dressSelector"></div><div class="dress-tags" id="selectedDresses"></div></div>
                        <div class="form-row"><div class="form-group"><label class="form-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô</label><select class="form-select" id="calcDays" onchange="calculatePrice()"><option value="1">1 ‡∏ß‡∏±‡∏ô</option><option value="3" selected>3 ‡∏ß‡∏±‡∏ô</option><option value="5">5 ‡∏ß‡∏±‡∏ô</option></select></div><div class="form-group"><label class="form-label">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Å‡πà‡∏≤?</label><select class="form-select" id="calcOldCustomer" onchange="calculatePrice()"><option value="false">‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà</option><option value="true">‡πÉ‡∏ä‡πà</option></select></div></div>
                        <div class="form-group"><label class="form-label">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏¥‡πÄ‡∏®‡∏©</label><div style="display:flex;gap:10px;flex-wrap:wrap"><button type="button" class="btn btn-toggle" id="btnFreeDeposit" onclick="toggleFreeDeposit()">üí∞ ‡∏ü‡∏£‡∏µ‡∏Ñ‡πà‡∏≤‡∏°‡∏±‡∏î‡∏à‡∏≥</button><button type="button" class="btn btn-toggle" id="btnFreeShipping" onclick="toggleFreeShipping()">üöö ‡∏ü‡∏£‡∏µ‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á</button></div></div>
                        <div class="form-group" id="extraDiscountCheckboxes" style="display:none"><label class="form-label">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label><div id="extraDiscountOptions"></div></div>
                        <div class="price-result" id="priceResult" style="display:none"><div class="price-row"><span class="price-label">‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏ä‡∏∏‡∏î</span><span class="price-value" id="priceSubtotal">0 ‡∏ø</span></div><div id="discountRows"></div><div class="price-row"><span class="price-label">‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á</span><span class="price-value" id="priceShipping">0 ‡∏ø</span></div><div class="price-row"><span class="price-label">‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</span><span class="price-value" id="priceRental">0 ‡∏ø</span></div><div class="price-row"><span class="price-label" id="depositLabel">‡∏Ñ‡πà‡∏≤‡∏°‡∏±‡∏î‡∏à‡∏≥</span><span class="price-value" id="priceDeposit">0 ‡∏ø</span></div><div class="price-row total"><span class="price-label">üí∞ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span><span class="price-value" id="priceTotal">0 ‡∏ø</span></div></div>
                    </div>
                </div>
                <div class="card"><div class="card-header"><div class="card-title">üìå ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</div></div><div class="card-body" id="currentRulesDisplay"><div class="loading"><div class="spinner"></div></div></div></div>
            </div>
        </div>
        <div id="promoPage" class="page">
            <div class="card">
                <div class="card-header"><div class="card-title">üéÅ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</div><button class="btn btn-primary" onclick="savePromoSettings()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button></div>
                <div class="card-body">
                    <div class="promo-card"><div class="promo-item"><div class="promo-info"><div class="promo-name">üëó ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡πÄ‡∏ä‡πà‡∏≤‡∏´‡∏•‡∏≤‡∏¢‡∏ä‡∏∏‡∏î</div><div class="promo-desc">‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡πà‡∏≤‡∏Ñ‡∏£‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</div></div><div class="promo-controls"><div class="promo-value"><span>‡πÄ‡∏ä‡πà‡∏≤‡∏Ñ‡∏£‡∏ö</span><input type="number" id="promoMultiQty" value="3" min="2" max="10"><span class="promo-unit">‡∏ä‡∏∏‡∏î ‡∏•‡∏î</span><input type="number" id="promoMultiDiscount" value="10" min="0" max="50"><span class="promo-unit">%</span></div><label class="toggle-switch"><input type="checkbox" id="promoMultiEnabled" checked><span class="toggle-slider"></span></label></div></div></div>
                    <div class="promo-card"><div class="promo-item"><div class="promo-info"><div class="promo-name">üíù ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Å‡πà‡∏≤</div><div class="promo-desc">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏ä‡πà‡∏≤</div></div><div class="promo-controls"><div class="promo-value"><span>‡∏•‡∏î</span><input type="number" id="promoOldCustomerDiscount" value="5" min="0" max="30"><span class="promo-unit">%</span></div><label class="toggle-switch"><input type="checkbox" id="promoOldCustomerEnabled" checked><span class="toggle-slider"></span></label></div></div></div>
                    <div class="promo-card"><div class="promo-item"><div class="promo-info"><div class="promo-name">üöö ‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ</div><div class="promo-desc">‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡πà‡∏≤‡∏Ñ‡∏£‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</div></div><div class="promo-controls"><div class="promo-value"><span>‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á</span><input type="number" id="promoShippingCost" value="35" min="0" max="200"><span class="promo-unit">‡∏ø ‡∏ü‡∏£‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠</span><input type="number" id="promoFreeShipQty" value="2" min="1" max="10"><span class="promo-unit">‡∏ä‡∏∏‡∏î</span></div><label class="toggle-switch"><input type="checkbox" id="promoFreeShipEnabled" checked><span class="toggle-slider"></span></label></div></div></div>
                    <div class="promo-card"><div class="promo-item"><div class="promo-info"><div class="promo-name">üí∞ ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Ñ‡∏¥‡∏î‡∏Ñ‡πà‡∏≤‡∏°‡∏±‡∏î‡∏à‡∏≥</div></div><div class="promo-controls"><select class="form-select" id="promoDepositType" style="width:auto" onchange="toggleDepositOptions()"><option value="price3">‡∏£‡∏≤‡∏Ñ‡∏≤ 3 ‡∏ß‡∏±‡∏ô</option><option value="price1">‡∏£‡∏≤‡∏Ñ‡∏≤ 1 ‡∏ß‡∏±‡∏ô</option><option value="fixed">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏á‡∏ó‡∏µ‡πà</option><option value="percent">‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå</option></select><div class="promo-value" id="depositFixedValue" style="display:none"><input type="number" id="promoDepositFixed" value="500" min="0"><span class="promo-unit">‡∏ø/‡∏ä‡∏∏‡∏î</span></div><div class="promo-value" id="depositPercentValue" style="display:none"><input type="number" id="promoDepositPercent" value="100" min="0" max="200"><span class="promo-unit">%</span></div></div></div></div>
                    <div class="promo-card"><div class="promo-item" style="flex-direction:column;align-items:stretch"><div class="promo-info" style="margin-bottom:15px"><div class="promo-name">‚ú® ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</div></div><div class="extra-discounts" id="extraDiscounts"></div><button class="btn btn-secondary" onclick="addExtraDiscount()" style="margin-top:10px">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏©</button></div></div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-overlay" id="orderModal"><div class="modal-content"><div class="modal-header"><h3>üìã ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå <span id="modalOrderId" class="order-id"></span></h3><button class="close-btn" onclick="closeModal()">√ó</button></div><div class="modal-body" id="modalBody"></div></div></div>
    <div class="modal-overlay" id="addOrderModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>üìù ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà</h3>
            <button class="close-btn" onclick="closeAddModal()">√ó</button>
        </div>
        <div class="modal-body">
            <div class="modal-section">
                <div class="modal-section-title">üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</div>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</label><input type="text" id="addName" class="form-input"></div>
                    <div class="form-group"><label class="form-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label><input type="text" id="addPhone" class="form-input"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">Line ID</label><input type="text" id="addLine" class="form-input"></div>
                    <div class="form-group"><label class="form-label">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</label><input type="text" id="addAddress" class="form-input"></div>
                </div>
            </div>

            <div class="modal-section">
                <div class="modal-section-title">üëó ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πà‡∏≤</div>
                <div class="form-group"><label class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏ä‡∏∏‡∏î (‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢ , ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏´‡∏•‡∏≤‡∏¢‡∏ä‡∏∏‡∏î)</label>
                    <input type="text" id="addDressCode" class="form-input" placeholder="‡πÄ‡∏ä‡πà‡∏ô D001, D002">
                </div>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</label><input type="date" id="addStartDate" class="form-input" onchange="calcDates()"></div>
                    <div class="form-group"><label class="form-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô</label>
                        <select id="addDays" class="form-select" onchange="calcDates()">
                            <option value="3">3 ‡∏ß‡∏±‡∏ô</option>
                            <option value="5">5 ‡∏ß‡∏±‡∏ô</option>
                            <option value="1">1 ‡∏ß‡∏±‡∏ô</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">‡∏£‡∏±‡∏ö‡∏ä‡∏∏‡∏î (Pickup)</label><input type="date" id="addPickup" class="form-input"></div>
                    <div class="form-group"><label class="form-label">‡∏Ñ‡∏∑‡∏ô‡∏ä‡∏∏‡∏î (Return)</label><input type="date" id="addReturn" class="form-input"></div>
                </div>
            </div>

            <div class="modal-section">
                <div class="modal-section-title">üí∞ ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô</div>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤</label><input type="number" id="addRental" class="form-input" value="0" oninput="calcTotal()"></div>
                    <div class="form-group"><label class="form-label">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</label><input type="number" id="addDiscount" class="form-input" value="0" oninput="calcTotal()"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á</label><input type="number" id="addShipping" class="form-input" value="0" oninput="calcTotal()"></div>
                    <div class="form-group"><label class="form-label">‡∏°‡∏±‡∏î‡∏à‡∏≥</label><input type="number" id="addDeposit" class="form-input" value="0" oninput="calcTotal()"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</label>
                    <input type="number" id="addTotal" class="form-input" style="font-weight:bold; color:var(--accent); font-size:1.2rem" readonly>
                </div>
                <div class="form-group">
                    <label style="display:flex;align-items:center;gap:10px;cursor:pointer">
                        <input type="checkbox" id="addIsOld"> <span>‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Å‡πà‡∏≤?</span>
                    </label>
                </div>
            </div>
            
            <button class="btn btn-primary" style="width:100%; justify-content:center" onclick="saveOrder()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button>
        </div>
    </div>
</div>
    <div class="toast-container" id="toastContainer"></div>
    <script>
        const API='https://script.google.com/macros/s/AKfycbxHFv0nr7zEYwiLfFRzJ-GlgWXxP353MdGXvAzqsma29aCXcmFU9zUUanNjYsSqv-NaLA/exec';
        const PROMO_KEY='rental_promo_settings';
        let dresses=[],blocks=[],orders=[];
        let globalMonth=new Date().getMonth(),globalYear=new Date().getFullYear();
        let selectedDressesForCalc=[],selectedExtraDiscounts=[];
        let isFreeDeposit=false,isFreeShipping=false;
        let promoSettings={multiDress:{enabled:true,minQty:3,discount:10},oldCustomer:{enabled:true,discount:5},shipping:{enabled:true,cost:35,freeQty:2},deposit:{type:'price3',fixedAmount:500,percent:100},extraDiscounts:[]};

        async function init(){loadPromoSettings();await Promise.all([loadDresses(),loadBlocks(),loadOrders()]);renderAll()}
        async function loadDresses(){try{const r=await fetch(API+'?action=list');const d=await r.json();if(d.success)dresses=d.data}catch(e){showToast('‡πÇ‡∏´‡∏•‡∏î‡∏ä‡∏∏‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','error')}}
        async function loadBlocks(){try{const r=await fetch(API+'?action=getCalendarBlocks');const d=await r.json();if(d.success)blocks=d.blocks}catch(e){showToast('‡πÇ‡∏´‡∏•‡∏î‡∏ö‡∏•‡πá‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','error')}}
        async function loadOrders(){try{const r=await fetch(API+'?action=getOrders');const d=await r.json();if(d.success)orders=d.orders}catch(e){showToast('‡πÇ‡∏´‡∏•‡∏î‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','error')}}
        function renderAll(){renderOrderStats();renderOrders();renderStats();renderCalendars();renderBlocksList();renderDressSelector();populateFilters();renderCurrentRules();renderActivePromos();renderExtraDiscountCheckboxes()}
        
        function renderOrderStats(){document.getElementById('statTotalOrders').textContent=orders.length;document.getElementById('statPendingOrders').textContent=orders.filter(o=>o.status==='‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞').length;document.getElementById('statConfirmedOrders').textContent=orders.filter(o=>o.status==='‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß'||o.status==='‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß').length;document.getElementById('statReturnedOrders').textContent=orders.filter(o=>o.status==='‡∏Ñ‡∏∑‡∏ô‡∏ä‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß').length}
        
        function renderOrders(){const tbody=document.getElementById('ordersTableBody');const search=document.getElementById('orderSearch').value.toLowerCase();const statusFilter=document.getElementById('orderStatusFilter').value;let filtered=orders.filter(o=>{const matchSearch=!search||o.id.toLowerCase().includes(search)||o.customerName.toLowerCase().includes(search)||o.phone.includes(search)||o.dressCode.toLowerCase().includes(search);const matchStatus=!statusFilter||o.status===statusFilter;return matchSearch&&matchStatus});if(!filtered.length){tbody.innerHTML='<tr><td colspan="7" style="text-align:center;color:var(--text-secondary);padding:40px;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</td></tr>';return}tbody.innerHTML=filtered.map(o=>`<tr><td><span class="order-id">${o.id}</span></td><td><div class="order-customer">${o.customerName}</div><div class="order-customer-phone">üì± ${o.phone}</div></td><td><span class="order-dresses">${o.dressCode}</span></td><td><div class="order-dates"><div class="order-date-row"><span class="order-date-label">üì§ ‡∏™‡πà‡∏á:</span><span class="order-date-value">${formatDateThai(o.pickupDate)}</span></div><div class="order-date-row"><span class="order-date-label">üéâ ‡πÉ‡∏ä‡πâ:</span><span class="order-date-value">${formatDateThai(o.startDate)} - ${formatDateThai(o.endDate)}</span></div><div class="order-date-row"><span class="order-date-label">üì• ‡∏Ñ‡∏∑‡∏ô:</span><span class="order-date-value">${formatDateThai(o.returnDate)}</span></div></div></td><td><strong style="color:var(--accent);font-family:'Space Mono',monospace">${Number(o.total).toLocaleString()} ‡∏ø</strong></td><td><span class="status-badge ${getStatusClass(o.status)}">${o.status}</span></td><td><div class="order-actions"><button class="btn btn-sm btn-secondary" onclick="viewOrder('${o.id}')">üëÅÔ∏è</button>${getStatusButtons(o)}</div></td></tr>`).join('')}
        
        function getStatusClass(s){const m={'‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞':'pending','‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß':'confirmed','‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß':'shipped','‡∏Ñ‡∏∑‡∏ô‡∏ä‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß':'returned','‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å':'cancelled'};return m[s]||''}
        function getStatusButtons(o){let h='';if(o.status==='‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞'){h+=`<button class="btn btn-sm btn-success" onclick="updateStatus('${o.id}','‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß')">‚úÖ</button><button class="btn btn-sm btn-danger" onclick="updateStatus('${o.id}','‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å')">‚ùå</button>`}else if(o.status==='‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß'){h+=`<button class="btn btn-sm btn-info" onclick="updateStatus('${o.id}','‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß')">üì¶</button>`}else if(o.status==='‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß'){h+=`<button class="btn btn-sm btn-success" onclick="updateStatus('${o.id}','‡∏Ñ‡∏∑‡∏ô‡∏ä‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß')">‚úÖ</button>`}return h}
        
        function viewOrder(id){const o=orders.find(x=>x.id===id);if(!o)return;document.getElementById('modalOrderId').textContent=o.id;const today=new Date();today.setHours(0,0,0,0);const pickup=new Date(o.pickupDate);const start=new Date(o.startDate);const end=new Date(o.endDate);const returnD=new Date(o.returnDate);document.getElementById('modalBody').innerHTML=`<div class="modal-section"><div class="modal-section-title">üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</div><div class="modal-row"><span class="modal-label">‡∏ä‡∏∑‡πà‡∏≠</span><span class="modal-value">${o.customerName}</span></div><div class="modal-row"><span class="modal-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</span><span class="modal-value">${o.phone}</span></div><div class="modal-row"><span class="modal-label">Line ID</span><span class="modal-value">${o.lineId||'-'}</span></div><div class="modal-row"><span class="modal-label">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</span><span class="modal-value">${o.address||'-'}</span></div><div class="modal-row"><span class="modal-label">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Å‡πà‡∏≤</span><span class="modal-value">${o.isOldCustomer==='‡πÉ‡∏ä‡πà'?'‚úÖ ‡πÉ‡∏ä‡πà':'‚ùå ‡πÑ‡∏°‡πà'}</span></div></div><div class="modal-section"><div class="modal-section-title">üëó ‡∏ä‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡πà‡∏≤</div><div class="modal-row"><span class="modal-label">‡∏£‡∏´‡∏±‡∏™‡∏ä‡∏∏‡∏î</span><span class="modal-value" style="font-family:'Space Mono',monospace;color:var(--accent)">${o.dressCode}</span></div><div class="modal-row"><span class="modal-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô</span><span class="modal-value">${o.days} ‡∏ß‡∏±‡∏ô</span></div></div><div class="modal-section"><div class="modal-section-title">üìÖ ‡πÑ‡∏ó‡∏°‡πå‡πÑ‡∏•‡∏ô‡πå</div><div class="timeline"><div class="timeline-point"><div class="timeline-dot ${today>=pickup?'active':''}">üì§</div><div class="timeline-date">${formatDateThai(o.pickupDate)}</div><div class="timeline-label">‡∏™‡πà‡∏á‡∏ä‡∏∏‡∏î</div></div><div class="timeline-point"><div class="timeline-dot ${today>=start?'active':''}">üéâ</div><div class="timeline-date">${formatDateThai(o.startDate)}</div><div class="timeline-label">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ</div></div><div class="timeline-point"><div class="timeline-dot ${today>=end?'active':''}">‚è∞</div><div class="timeline-date">${formatDateThai(o.endDate)}</div><div class="timeline-label">‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</div></div><div class="timeline-point"><div class="timeline-dot ${today>=returnD?'active':''}">üì•</div><div class="timeline-date">${formatDateThai(o.returnDate)}</div><div class="timeline-label">‡∏Ñ‡∏∑‡∏ô‡∏ä‡∏∏‡∏î</div></div></div></div><div class="modal-section"><div class="modal-section-title">üí∞ ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏Ñ‡∏≤</div><div class="modal-row"><span class="modal-label">‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤</span><span class="modal-value">${Number(o.rental).toLocaleString()} ‡∏ø</span></div>${o.discount>0?`<div class="modal-row"><span class="modal-label">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</span><span class="modal-value" style="color:var(--success)">-${Number(o.discount).toLocaleString()} ‡∏ø</span></div>`:''}<div class="modal-row"><span class="modal-label">‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á</span><span class="modal-value">${o.shipping==0?'‡∏ü‡∏£‡∏µ':o.shipping+' ‡∏ø'}</span></div><div class="modal-row"><span class="modal-label">‡∏Ñ‡πà‡∏≤‡∏°‡∏±‡∏î‡∏à‡∏≥</span><span class="modal-value">${Number(o.deposit).toLocaleString()} ‡∏ø</span></div><div class="modal-row" style="border-top:2px solid var(--accent);padding-top:15px;margin-top:10px"><span class="modal-label" style="font-weight:600;color:var(--accent)">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span><span class="modal-value" style="font-size:1.3rem;color:var(--accent)">${Number(o.total).toLocaleString()} ‡∏ø</span></div></div><div class="modal-section"><div class="modal-section-title">üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</div><div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:15px"><span class="status-badge ${getStatusClass(o.status)}" style="font-size:1rem;padding:10px 20px">${o.status}</span><div class="order-actions">${getStatusButtons(o)}</div></div></div>`;document.getElementById('orderModal').classList.add('active')}
        
        function closeModal(){document.getElementById('orderModal').classList.remove('active')}
        async function updateStatus(id,newStatus){const msg=newStatus==='‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'?'‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å?':`‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô "${newStatus}"?`;if(!confirm(msg))return;try{const r=await fetch(`${API}?action=updateStatus&orderId=${id}&status=${encodeURIComponent(newStatus)}`);const d=await r.json();if(d.success){showToast('‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','success');await Promise.all([loadOrders(),loadBlocks()]);renderAll();closeModal()}else showToast(d.error||'‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î','error')}catch(e){showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î','error')}}
        function filterOrders(){renderOrders()}
        
        function renderStats(){const today=formatDate(new Date());let bookedToday=0;dresses.forEach(d=>{const isBooked=blocks.filter(b=>b.dressCode===d.code).some(b=>{const s=formatDate(new Date(b.startDate));const e=formatDate(new Date(b.endDate));return today>=s&&today<=e});if(isBooked)bookedToday++});document.getElementById('statTotal').textContent=dresses.length;document.getElementById('statAvailable').textContent=dresses.length-bookedToday;document.getElementById('statBooked').textContent=bookedToday;document.getElementById('statBlocks').textContent=blocks.length}
        
        function renderCalendars(){const c=document.getElementById('calendarsGrid');const search=document.getElementById('calendarSearch').value.toLowerCase();const brandFilter=document.getElementById('calendarBrandFilter').value;let filtered=dresses.filter(d=>{const ms=!search||d.code.toLowerCase().includes(search)||d.name.toLowerCase().includes(search);const mb=!brandFilter||d.brand===brandFilter;return ms&&mb});if(!filtered.length){c.innerHTML='<p style="grid-column:1/-1;text-align:center;color:var(--text-secondary);padding:40px;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏∏‡∏î</p>';return}const months=['‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°','‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå','‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°','‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô','‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°','‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô','‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°','‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°','‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô','‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°','‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô','‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'];document.getElementById('globalMonthYear').textContent=months[globalMonth]+' '+(globalYear+543);c.innerHTML=filtered.map(d=>{const db=blocks.filter(b=>b.dressCode===d.code);return '<div class="calendar-card"><div class="calendar-card-header"><div class="calendar-card-title"><span class="code">'+d.code+'</span>'+d.name+'</div></div><div class="calendar-grid"><div class="calendar-header-day">‡∏≠‡∏≤</div><div class="calendar-header-day">‡∏à</div><div class="calendar-header-day">‡∏≠</div><div class="calendar-header-day">‡∏û</div><div class="calendar-header-day">‡∏û‡∏§</div><div class="calendar-header-day">‡∏®</div><div class="calendar-header-day">‡∏™</div>'+generateCalendarDays(db)+'</div></div>'}).join('')}
        
        function generateCalendarDays(db){const today=new Date();today.setHours(0,0,0,0);const firstDay=new Date(globalYear,globalMonth,1);const lastDay=new Date(globalYear,globalMonth+1,0);let h='';for(let i=0;i<firstDay.getDay();i++)h+='<div class="calendar-day empty"></div>';for(let d=1;d<=lastDay.getDate();d++){const date=new Date(globalYear,globalMonth,d);const ds=formatDate(date);let cls='calendar-day';if(date<today)cls+=' past';else{const isBooked=db.some(b=>{const s=formatDate(new Date(b.startDate));const e=formatDate(new Date(b.endDate));return ds>=s&&ds<=e});if(isBooked)cls+=' booked'}if(date.getTime()===today.getTime())cls+=' today';h+='<div class="'+cls+'">'+d+'</div>'}return h}
        
        function renderBlocksList(){const c=document.getElementById('blocksList');const ft=document.getElementById('blockFilterType').value;let filtered=ft?blocks.filter(b=>b.type===ft):blocks;filtered.sort((a,b)=>new Date(b.createdAt)-new Date(a.createdAt));if(!filtered.length){c.innerHTML='<p style="text-align:center;color:var(--text-secondary);padding:20px;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏•‡πá‡∏≠‡∏Å</p>';return}c.innerHTML=filtered.map(b=>'<div class="block-item"><div><span class="block-code">'+b.dressCode+'</span><span class="block-type '+(b.type==='‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå'?'order':'custom')+'">'+b.type+'</span><div class="block-dates">üìÖ '+formatDateThai(b.startDate)+' - '+formatDateThai(b.endDate)+'</div></div><button class="btn btn-danger btn-sm" onclick="deleteBlock(\''+b.id+'\')">üóëÔ∏è</button></div>').join('')}
        
        async function addBlock(){const code=document.getElementById('blockDressCode').value;const startDate=document.getElementById('blockStartDate').value;const endDate=document.getElementById('blockEndDate').value;const type=document.getElementById('blockType').value;if(!code||!startDate||!endDate){showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö','error');return}if(new Date(startDate)>new Date(endDate)){showToast('‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î','error');return}try{const r=await fetch(API+'?action=addCalendarBlock&dressCode='+code+'&startDate='+startDate+'&endDate='+endDate+'&type='+encodeURIComponent(type));const d=await r.json();if(d.success){showToast('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','success');document.getElementById('blockDressCode').value='';document.getElementById('blockStartDate').value='';document.getElementById('blockEndDate').value='';await loadBlocks();renderAll()}}catch(e){showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î','error')}}
        
        async function deleteBlock(id){if(!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏ô‡∏µ‡πâ?'))return;try{const r=await fetch(API+'?action=deleteCalendarBlock&id='+id);const d=await r.json();if(d.success){showToast('‡∏•‡∏ö‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','success');await loadBlocks();renderAll()}}catch(e){showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î','error')}}
        
        function toggleFreeDeposit(){isFreeDeposit=!isFreeDeposit;document.getElementById('btnFreeDeposit').classList.toggle('active',isFreeDeposit);calculatePrice()}
        function toggleFreeShipping(){isFreeShipping=!isFreeShipping;document.getElementById('btnFreeShipping').classList.toggle('active',isFreeShipping);calculatePrice()}
        
        function renderDressSelector(){document.getElementById('dressSelector').innerHTML=dresses.map(d=>'<div class="dress-option '+(selectedDressesForCalc.includes(d.code)?'selected':'')+'" onclick="toggleDressSelection(\''+d.code+'\')"><div class="dress-option-code">'+d.code+'</div><div class="dress-option-name">'+d.name+'</div></div>').join('');updateSelectedDressTags()}
        function updateSelectedDressTags(){const c=document.getElementById('selectedDresses');if(!selectedDressesForCalc.length){c.innerHTML='<span style="color:var(--text-muted);font-size:.85rem">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î</span>';return}c.innerHTML=selectedDressesForCalc.map(code=>'<div class="dress-tag"><span>'+code+'</span><span class="remove" onclick="removeDressSelection(\''+code+'\')">&times;</span></div>').join('');calculatePrice()}
        function toggleDressSelection(code){const idx=selectedDressesForCalc.indexOf(code);if(idx>-1)selectedDressesForCalc.splice(idx,1);else selectedDressesForCalc.push(code);renderDressSelector()}
        function removeDressSelection(code){selectedDressesForCalc=selectedDressesForCalc.filter(c=>c!==code);renderDressSelector()}
        
        function calculatePrice(){const resultDiv=document.getElementById('priceResult');if(!selectedDressesForCalc.length){resultDiv.style.display='none';return}resultDiv.style.display='block';const days=parseInt(document.getElementById('calcDays').value);const isOldCustomer=document.getElementById('calcOldCustomer').value==='true';let subtotal=0,depositTotal=0;selectedDressesForCalc.forEach(code=>{const dress=dresses.find(d=>d.code===code);if(dress){const price=days===1?dress.price1:days===3?dress.price3:dress.price5;subtotal+=price;switch(promoSettings.deposit.type){case'price3':depositTotal+=dress.price3;break;case'price1':depositTotal+=dress.price1;break;case'fixed':depositTotal+=promoSettings.deposit.fixedAmount;break}}});if(promoSettings.deposit.type==='percent')depositTotal=Math.round(subtotal*promoSettings.deposit.percent/100);let discounts=[],totalDiscount=0;if(promoSettings.multiDress.enabled&&selectedDressesForCalc.length>=promoSettings.multiDress.minQty){const amount=Math.round(subtotal*promoSettings.multiDress.discount/100);discounts.push({label:'‡∏•‡∏î‡πÄ‡∏ä‡πà‡∏≤ '+promoSettings.multiDress.minQty+'+ ‡∏ä‡∏∏‡∏î ('+promoSettings.multiDress.discount+'%)',amount});totalDiscount+=amount}if(promoSettings.oldCustomer.enabled&&isOldCustomer){const amount=Math.round(subtotal*promoSettings.oldCustomer.discount/100);discounts.push({label:'‡∏•‡∏î‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Å‡πà‡∏≤ ('+promoSettings.oldCustomer.discount+'%)',amount});totalDiscount+=amount}selectedExtraDiscounts.forEach(idx=>{const d=promoSettings.extraDiscounts[idx];if(d){const amount=d.type==='percent'?Math.round(subtotal*d.value/100):d.value;discounts.push({label:d.name+' ('+d.value+(d.type==='percent'?'%':'‡∏ø')+')',amount});totalDiscount+=amount}});let shipping=promoSettings.shipping.cost;if(isFreeShipping||(promoSettings.shipping.enabled&&selectedDressesForCalc.length>=promoSettings.shipping.freeQty))shipping=0;if(isFreeDeposit)depositTotal=0;const rentalTotal=Math.max(0,subtotal-totalDiscount+shipping);const grandTotal=rentalTotal+depositTotal;document.getElementById('priceSubtotal').textContent=subtotal.toLocaleString()+' ‡∏ø';document.getElementById('discountRows').innerHTML=discounts.map(d=>'<div class="price-row"><span class="price-label">'+d.label+'</span><span class="price-value" style="color:var(--success)">-'+d.amount.toLocaleString()+' ‡∏ø</span></div>').join('');document.getElementById('priceShipping').textContent=shipping===0?'‡∏ü‡∏£‡∏µ! üéâ':shipping+' ‡∏ø';document.getElementById('priceRental').textContent=rentalTotal.toLocaleString()+' ‡∏ø';document.getElementById('priceDeposit').textContent=isFreeDeposit?'‡∏ü‡∏£‡∏µ! üéâ':depositTotal.toLocaleString()+' ‡∏ø';document.getElementById('priceDeposit').style.color=isFreeDeposit?'var(--success)':'';document.getElementById('priceTotal').textContent=grandTotal.toLocaleString()+' ‡∏ø';let depositLabel='‡∏Ñ‡πà‡∏≤‡∏°‡∏±‡∏î‡∏à‡∏≥';switch(promoSettings.deposit.type){case'price3':depositLabel+=' (‡∏£‡∏≤‡∏Ñ‡∏≤ 3 ‡∏ß‡∏±‡∏ô)';break;case'price1':depositLabel+=' (‡∏£‡∏≤‡∏Ñ‡∏≤ 1 ‡∏ß‡∏±‡∏ô)';break;case'fixed':depositLabel+=' ('+promoSettings.deposit.fixedAmount+'‡∏ø/‡∏ä‡∏∏‡∏î)';break;case'percent':depositLabel+=' ('+promoSettings.deposit.percent+'%)';break}document.getElementById('depositLabel').textContent=depositLabel}
        
        function loadPromoSettings(){try{const saved=localStorage.getItem(PROMO_KEY);if(saved)promoSettings=JSON.parse(saved)}catch(e){}applyPromoSettingsToUI()}
        function savePromoSettings(){promoSettings.multiDress.enabled=document.getElementById('promoMultiEnabled').checked;promoSettings.multiDress.minQty=parseInt(document.getElementById('promoMultiQty').value)||3;promoSettings.multiDress.discount=parseInt(document.getElementById('promoMultiDiscount').value)||10;promoSettings.oldCustomer.enabled=document.getElementById('promoOldCustomerEnabled').checked;promoSettings.oldCustomer.discount=parseInt(document.getElementById('promoOldCustomerDiscount').value)||5;promoSettings.shipping.enabled=document.getElementById('promoFreeShipEnabled').checked;promoSettings.shipping.cost=parseInt(document.getElementById('promoShippingCost').value)||35;promoSettings.shipping.freeQty=parseInt(document.getElementById('promoFreeShipQty').value)||2;promoSettings.deposit.type=document.getElementById('promoDepositType').value;promoSettings.deposit.fixedAmount=parseInt(document.getElementById('promoDepositFixed').value)||500;promoSettings.deposit.percent=parseInt(document.getElementById('promoDepositPercent').value)||100;promoSettings.extraDiscounts=[];document.querySelectorAll('.extra-discount-item').forEach(item=>{const name=item.querySelector('.extra-name').value;const value=parseInt(item.querySelector('.extra-value').value)||0;const type=item.querySelector('.extra-type').value;if(name&&value>0)promoSettings.extraDiscounts.push({name,value,type})});try{localStorage.setItem(PROMO_KEY,JSON.stringify(promoSettings));showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!','success')}catch(e){showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','error')}renderCurrentRules();renderActivePromos();renderExtraDiscountCheckboxes();calculatePrice()}
        function applyPromoSettingsToUI(){document.getElementById('promoMultiEnabled').checked=promoSettings.multiDress.enabled;document.getElementById('promoMultiQty').value=promoSettings.multiDress.minQty;document.getElementById('promoMultiDiscount').value=promoSettings.multiDress.discount;document.getElementById('promoOldCustomerEnabled').checked=promoSettings.oldCustomer.enabled;document.getElementById('promoOldCustomerDiscount').value=promoSettings.oldCustomer.discount;document.getElementById('promoFreeShipEnabled').checked=promoSettings.shipping.enabled;document.getElementById('promoShippingCost').value=promoSettings.shipping.cost;document.getElementById('promoFreeShipQty').value=promoSettings.shipping.freeQty;document.getElementById('promoDepositType').value=promoSettings.deposit.type;document.getElementById('promoDepositFixed').value=promoSettings.deposit.fixedAmount;document.getElementById('promoDepositPercent').value=promoSettings.deposit.percent;toggleDepositOptions();renderExtraDiscountsUI()}
        function toggleDepositOptions(){const type=document.getElementById('promoDepositType').value;document.getElementById('depositFixedValue').style.display=type==='fixed'?'flex':'none';document.getElementById('depositPercentValue').style.display=type==='percent'?'flex':'none'}
        function renderExtraDiscountsUI(){document.getElementById('extraDiscounts').innerHTML=promoSettings.extraDiscounts.map((d,idx)=>'<div class="extra-discount-item"><input type="text" class="extra-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î" value="'+d.name+'"><input type="number" class="extra-value" placeholder="0" value="'+d.value+'" min="0"><select class="extra-type"><option value="percent"'+(d.type==='percent'?' selected':'')+'>%</option><option value="fixed"'+(d.type==='fixed'?' selected':'')+'>‡∏ø</option></select><button class="btn btn-danger btn-sm" onclick="removeExtraDiscount('+idx+')">üóëÔ∏è</button></div>').join('')}
        function addExtraDiscount(){promoSettings.extraDiscounts.push({name:'',value:0,type:'percent'});renderExtraDiscountsUI()}
        function removeExtraDiscount(idx){promoSettings.extraDiscounts.splice(idx,1);renderExtraDiscountsUI()}
        function renderCurrentRules(){let h='<div style="line-height:2">';if(promoSettings.multiDress.enabled)h+='<p>üéÅ <strong>‡πÄ‡∏ä‡πà‡∏≤ '+promoSettings.multiDress.minQty+' ‡∏ä‡∏∏‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ</strong> ‡∏•‡∏î '+promoSettings.multiDress.discount+'%</p>';if(promoSettings.oldCustomer.enabled)h+='<p>üíù <strong>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Å‡πà‡∏≤</strong> ‡∏•‡∏î '+promoSettings.oldCustomer.discount+'%</p>';if(promoSettings.shipping.enabled)h+='<p>üöö <strong>‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á</strong> '+promoSettings.shipping.cost+'‡∏ø (‡∏ü‡∏£‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠ '+promoSettings.shipping.freeQty+' ‡∏ä‡∏∏‡∏î)</p>';else h+='<p>üöö <strong>‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á</strong> '+promoSettings.shipping.cost+'‡∏ø</p>';let dt='';switch(promoSettings.deposit.type){case'price3':dt='‡∏£‡∏≤‡∏Ñ‡∏≤ 3 ‡∏ß‡∏±‡∏ô';break;case'price1':dt='‡∏£‡∏≤‡∏Ñ‡∏≤ 1 ‡∏ß‡∏±‡∏ô';break;case'fixed':dt=promoSettings.deposit.fixedAmount+'‡∏ø/‡∏ä‡∏∏‡∏î';break;case'percent':dt=promoSettings.deposit.percent+'%';break}h+='<p>üí∞ <strong>‡∏°‡∏±‡∏î‡∏à‡∏≥</strong> = '+dt+'</p>';if(promoSettings.extraDiscounts.length>0){h+='<hr style="border-color:var(--border);margin:15px 0"><p style="color:var(--accent)"><strong>‚ú® ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏©:</strong></p>';promoSettings.extraDiscounts.forEach(d=>{h+='<p>‚Ä¢ '+d.name+': '+d.value+(d.type==='percent'?'%':'‡∏ø')+'</p>'})}h+='</div>';document.getElementById('currentRulesDisplay').innerHTML=h}
        function renderActivePromos(){let tags=[];if(promoSettings.multiDress.enabled)tags.push('‡πÄ‡∏ä‡πà‡∏≤ '+promoSettings.multiDress.minQty+'+ ‡∏ä‡∏∏‡∏î ‡∏•‡∏î '+promoSettings.multiDress.discount+'%');if(promoSettings.oldCustomer.enabled)tags.push('‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Å‡πà‡∏≤ ‡∏•‡∏î '+promoSettings.oldCustomer.discount+'%');if(promoSettings.shipping.enabled)tags.push('‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ '+promoSettings.shipping.freeQty+'+ ‡∏ä‡∏∏‡∏î');document.getElementById('activePromoTags').innerHTML=tags.length>0?tags.map(t=>'<span class="active-promo-tag">'+t+'</span>').join(''):'<span style="color:var(--text-secondary)">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</span>'}
        function renderExtraDiscountCheckboxes(){const c=document.getElementById('extraDiscountOptions');const w=document.getElementById('extraDiscountCheckboxes');if(promoSettings.extraDiscounts.length===0){w.style.display='none';return}w.style.display='block';c.innerHTML=promoSettings.extraDiscounts.map((d,idx)=>'<label style="display:flex;align-items:center;gap:10px;padding:8px 0;cursor:pointer"><input type="checkbox" onchange="toggleExtraDiscountSelection('+idx+')"'+(selectedExtraDiscounts.includes(idx)?' checked':'')+'><span>'+d.name+' ('+d.value+(d.type==='percent'?'%':'‡∏ø')+')</span></label>').join('')}
        function toggleExtraDiscountSelection(idx){const i=selectedExtraDiscounts.indexOf(idx);if(i>-1)selectedExtraDiscounts.splice(i,1);else selectedExtraDiscounts.push(idx);calculatePrice()}
        function populateFilters(){const brands=[...new Set(dresses.map(d=>d.brand).filter(Boolean))];document.getElementById('calendarBrandFilter').innerHTML='<option value="">‡∏ó‡∏∏‡∏Å‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå</option>'+brands.map(b=>'<option value="'+b+'">'+b+'</option>').join('');document.getElementById('blockDressCode').innerHTML='<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î --</option>'+dresses.map(d=>'<option value="'+d.code+'">'+d.code+' - '+d.name+'</option>').join('')}
        
        function showPage(page,btn){document.querySelectorAll('.nav-tab').forEach(t=>t.classList.remove('active'));btn.classList.add('active');document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));document.getElementById(page+'Page').classList.add('active')}
        function changeGlobalMonth(delta){globalMonth+=delta;if(globalMonth>11){globalMonth=0;globalYear++}else if(globalMonth<0){globalMonth=11;globalYear--}renderCalendars()}
        function filterCalendars(){renderCalendars()}
        function filterBlocks(){renderBlocksList()}
        async function refreshAll(){showToast('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä...','info');await init();showToast('‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','success')}
        function formatDate(date){const d=new Date(date);return d.getFullYear()+'-'+String(d.getMonth()+1).padStart(2,'0')+'-'+String(d.getDate()).padStart(2,'0')}
        function formatDateThai(dateStr){const d=new Date(dateStr);const months=['‡∏°.‡∏Ñ.','‡∏Å.‡∏û.','‡∏°‡∏µ.‡∏Ñ.','‡πÄ‡∏°.‡∏¢.','‡∏û.‡∏Ñ.','‡∏°‡∏¥.‡∏¢.','‡∏Å.‡∏Ñ.','‡∏™.‡∏Ñ.','‡∏Å.‡∏¢.','‡∏ï.‡∏Ñ.','‡∏û.‡∏¢.','‡∏ò.‡∏Ñ.'];return d.getDate()+' '+months[d.getMonth()]+' '+(d.getFullYear()+543)}
        function showToast(message,type){const c=document.getElementById('toastContainer');const t=document.createElement('div');t.className='toast '+type;t.innerHTML='<span>'+(type==='success'?'‚úÖ':type==='error'?'‚ùå':'‚ÑπÔ∏è')+'</span><span>'+message+'</span>';c.appendChild(t);setTimeout(()=>{t.style.animation='slideIn .3s reverse';setTimeout(()=>t.remove(),300)},3000)}
        document.getElementById('orderModal').addEventListener('click',function(e){if(e.target===this)closeModal()});
        init();
    
    // ==========================================
// ‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå" (‡∏ß‡∏≤‡∏á‡∏ï‡πà‡∏≠‡∏ó‡πâ‡∏≤‡∏¢‡∏™‡∏∏‡∏î)
// ==========================================

function openAddModal() {
    document.getElementById('addOrderModal').classList.add('active');
    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
    document.getElementById('addStartDate').valueAsDate = new Date();
    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ß‡∏±‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏Ç‡∏≠‡∏á‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
    calcDates();
}

function closeAddModal() {
    document.getElementById('addOrderModal').classList.remove('active');
}

function calcDates() {
    // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏° ‡πÅ‡∏•‡∏∞ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô
    const startVal = document.getElementById('addStartDate').value;
    const days = parseInt(document.getElementById('addDays').value);
    
    if (startVal) {
        const startDate = new Date(startVal);
        
        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ß‡∏±‡∏ô‡∏£‡∏±‡∏ö‡∏ä‡∏∏‡∏î (Pickup) = ‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏° 2 ‡∏ß‡∏±‡∏ô
        const pickup = new Date(startDate);
        pickup.setDate(startDate.getDate() - 2);
        document.getElementById('addPickup').value = formatDateForInput(pickup);

        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ß‡∏±‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏ä‡∏∏‡∏î (Return) = ‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏° + ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô
        const returnDate = new Date(startDate);
        returnDate.setDate(startDate.getDate() + days); 
        document.getElementById('addReturn').value = formatDateForInput(returnDate);
    }
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏•‡∏á‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á input ‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (YYYY-MM-DD)
function formatDateForInput(date) {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    return `${year}-${month}-${day}`;
}

function calcTotal() {
    // ‡∏î‡∏∂‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏à‡∏≤‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡∏°‡∏≤‡∏ö‡∏ß‡∏Å‡∏•‡∏ö‡∏Å‡∏±‡∏ô
    const rental = parseFloat(document.getElementById('addRental').value) || 0;
    const discount = parseFloat(document.getElementById('addDiscount').value) || 0;
    const shipping = parseFloat(document.getElementById('addShipping').value) || 0;
    const deposit = parseFloat(document.getElementById('addDeposit').value) || 0;
    
    // ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° = (‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤ - ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î) + ‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á + ‡∏°‡∏±‡∏î‡∏à‡∏≥
    document.getElementById('addTotal').value = (rental - discount) + shipping + deposit;
}

async function saveOrder() {
    const btn = event.target;
    // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
    btn.innerHTML = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
    btn.disabled = true;

    // ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°
    const data = {
        action: 'addOrder',
        customerName: document.getElementById('addName').value,
        phone: document.getElementById('addPhone').value,
        lineId: document.getElementById('addLine').value,
        address: document.getElementById('addAddress').value,
        dressCode: document.getElementById('addDressCode').value,
        startDate: document.getElementById('addStartDate').value,
        days: document.getElementById('addDays').value,
        pickupDate: document.getElementById('addPickup').value,
        returnDate: document.getElementById('addReturn').value,
        endDate: document.getElementById('addReturn').value, 
        rentalPrice: document.getElementById('addRental').value,
        discount: document.getElementById('addDiscount').value,
        shipping: document.getElementById('addShipping').value,
        deposit: document.getElementById('addDeposit').value,
        totalPrice: document.getElementById('addTotal').value,
        isOldCustomer: document.getElementById('addIsOld').checked ? '‡πÉ‡∏ä‡πà' : '‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà'
    };

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö‡πÑ‡∏´‡∏°
    if (!data.customerName || !data.dressCode) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ä‡∏∏‡∏î', 'error');
        btn.innerHTML = 'üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå';
        btn.disabled = false;
        return;
    }

    try {
        // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏ó‡∏µ‡πà Google Sheet
        const params = new URLSearchParams();
        for (const key in data) {
            params.append(key, data[key]);
        }

        // ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ API ‡∏Ñ‡∏∑‡∏≠‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        const res = await fetch(API + '?' + params.toString());
        const json = await res.json();

        if (json.success) {
            showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ' + json.id, 'success');
            closeAddModal();
            
            // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÉ‡∏´‡πâ‡∏ß‡πà‡∏≤‡∏á
            document.getElementById('addName').value = '';
            document.getElementById('addPhone').value = '';
            document.getElementById('addDressCode').value = '';
            
            // ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏∂‡πâ‡∏ô
            // (‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô refreshAll() ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì)
            if(typeof refreshAll === 'function') {
                refreshAll();
            } else {
                location.reload();
            }
        } else {
            showToast('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + JSON.stringify(json), 'error');
        }
    } catch (e) {
        showToast('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ', 'error');
        console.error(e);
    }
    
    // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°
    btn.innerHTML = 'üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå';
    btn.disabled = false;
}
    
    </script>
</body>
</html>
